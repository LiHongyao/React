# 一、概述

组件的生命周期可分为三个阶段：

- 挂载时
- 更新时
- 卸载时

[生命周期图谱 >>](http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/)

# 二、生命周期方法

[具体参考 >>](https://zh-hans.reactjs.org/docs/react-component.html#the-component-lifecycle)

## 1. 挂载阶段

当组件实例被创建并插入 DOM 中时，其生命周期调用顺序如下：

**@V16.0 版本之后 **

- [**`constructor()`**](https://zh-hans.reactjs.org/docs/react-component.html#constructor)：构造函数，**如果不初始化 state 或不进行方法绑定，则无需实现**；
- [`static getDerivedStateFromProps()`](https://zh-hans.reactjs.org/docs/react-component.html#static-getderivedstatefromprops)：当`state`需要从`props`初始化时使用，返回对象来更新状态（新增/不常用）
- [**`render()`**](https://zh-hans.reactjs.org/docs/react-component.html#render)：渲染
- [**`componentDidMount()`**](https://zh-hans.reactjs.org/docs/react-component.html#componentdidmount)：组件已挂载（调用1次），可操作DOM/网络请求/添加订阅（常用）

**@V16.0 版本之前 **

- [**`constructor()`**](https://zh-hans.reactjs.org/docs/react-component.html#constructor)
- [`UNSAFE_componentWillMount()`](https://zh-hans.reactjs.org/docs/react-component.html#unsafe_componentwillmount)：组件即将被挂载，只调用1次，调用 `this.setState` 不会引起组件重新渲染。（已弃用）
- [**`render()`**](https://zh-hans.reactjs.org/docs/react-component.html#render)
- [**`componentDidMount()`**](https://zh-hans.reactjs.org/docs/react-component.html#componentdidmount)

## 2. 更新阶段

当组件的 props 或 state 发生变化时会触发更新。组件更新的生命周期调用顺序如下：

**@V16.0 版本之后**

- [`static getDerivedStateFromProps()`](https://zh-hans.reactjs.org/docs/react-component.html#static-getderivedstatefromprops)：当state需要从props初始化时使用，返回对象来更新状态（新增）
- [`shouldComponentUpdate()`](https://zh-hans.reactjs.org/docs/react-component.html#shouldcomponentupdate)：是否允许组件更新，此方法仅作为 **性能优化** 存在（不常用）
- [**`render()`**](https://zh-hans.reactjs.org/docs/react-component.html#render)：组件渲染
- [`getSnapshotBeforeUpdate()`](https://zh-hans.reactjs.org/docs/react-component.html#getsnapshotbeforeupdate)：在可能更改之前从DOM捕获一些信息（例如滚动位置）（新增/不常用）
- [**`componentDidUpdate()`**](https://zh-hans.reactjs.org/docs/react-component.html#componentdidupdate)：组件已更新，首次渲染不会触发该回调。（常用）

**@V16.0 版本之前 **

- [`UNSAFE_componentWillReceiveProps()`](https://zh-hans.reactjs.org/docs/react-component.html#unsafe_componentwillreceiveprops)：即将接收到属性，调用 `this.setState()` 将不会引起第二次渲染（已弃用）
- [`shouldComponentUpdate()`](https://zh-hans.reactjs.org/docs/react-component.html#shouldcomponentupdate)
- [`UNSAFE_componentWillUpdate()`](https://zh-hans.reactjs.org/docs/react-component.html#unsafe_componentwillupdate)：组件将要更新，不能修改属性和状态（已弃用）
- [**`render()`**](https://zh-hans.reactjs.org/docs/react-component.html#render)
- [**`componentDidUpdate()`**](https://zh-hans.reactjs.org/docs/react-component.html#componentdidupdate)

> Tips：
>
> 1）只有当props更新时才会调用第 `1` 步。
>
> 2）触发组件更新方式：`render()`、`setState()`、`forceUpdate()`

## 3. 卸载阶段

- [**`componentWillUnmount()`**](https://zh-hans.reactjs.org/docs/react-component.html#componentwillunmount)：组件即将被卸载及销毁，使用场景：资源释放（清除定时器/取消网络请求/移除订阅等）（常用）

## 4. 错误处理

- [`static getDerivedStateFromError()`](https://zh-hans.reactjs.org/docs/react-component.html#static-getderivedstatefromerror)：后代组件抛出错误被调用，不允许出现副作用。
- [`componentDidCatch()`](https://zh-hans.reactjs.org/docs/react-component.html#componentdidcatch)


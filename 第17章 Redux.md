# ä¸€ã€æ¦‚è§ˆ

React çš„å¤–éƒ¨çŠ¶æ€ç®¡ç†åº“ä¸€ç›´ä»¥æ¥æ˜¯ React ç”Ÿæ€ä¸­éå¸¸å†…å·çš„ä¸€ä¸ªé¢†åŸŸã€‚ç›®å‰æ¯”è¾ƒå¸¸è§çš„çŠ¶æ€ç®¡ç†åº“æœ‰ Reduxï¼ˆåŒ…æ‹¬åŸºäº Redux çš„ Dvaã€Icestoreï¼‰ã€Mobxã€Zustandã€Recoilã€Jotaiã€Valtioã€Hox ç­‰ã€‚

ç»¼åˆ [npmtrends >>](https://npmtrends.com/hox-vs-jotai-vs-mobx-vs-recoil-vs-redux-vs-valtio-vs-zustand) ä¸Šè¿‘ä¸€å¹´å„ä¸ªåº“åœ¨npmä¸Šçš„ä¸‹è½½é‡æ¥çœ‹ï¼ŒRedux å±äºæ¯”è¾ƒå—æ¬¢è¿çš„ä¸€ä¸ªåº“ï¼Œæ‰€ä»¥è¿™é‡Œå‘¢ï¼Œä¹Ÿä¸»è¦æ˜¯è®²è§£ Redux çš„ä½¿ç”¨ã€‚

## Redux æ˜¯ä»€ä¹ˆâ“

[Redux >>](https://cn.redux.js.org/) æ˜¯ JavaScript åº”ç”¨çš„çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹çš„çŠ¶æ€ç®¡ç†ï¼ˆæ•°æ®æµç®¡ç†ï¼‰ã€‚

> æ‘˜è‡ªå®˜ç½‘ï¼š***Redux æ˜¯ä¸€ä¸ªä½¿ç”¨å«åš â€œactionâ€ çš„äº‹ä»¶æ¥ç®¡ç†å’Œæ›´æ–°åº”ç”¨çŠ¶æ€çš„æ¨¡å¼å’Œå·¥å…·åº“** å®ƒä»¥é›†ä¸­å¼ Storeï¼ˆcentralized storeï¼‰çš„æ–¹å¼å¯¹æ•´ä¸ªåº”ç”¨ä¸­ä½¿ç”¨çš„çŠ¶æ€è¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œå…¶è§„åˆ™ç¡®ä¿çŠ¶æ€åªèƒ½ä»¥å¯é¢„æµ‹çš„æ–¹å¼æ›´æ–°ã€‚*

## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Reduxâ“

Redux å¸®ä½ ç®¡ç† â€œ**å…¨å±€**â€ çŠ¶æ€ - åº”ç”¨ç¨‹åºä¸­çš„å¾ˆå¤šç»„ä»¶éƒ½éœ€è¦çš„çŠ¶æ€ã€‚

**Redux æä¾›çš„æ¨¡å¼å’Œå·¥å…·ä½¿ä½ æ›´å®¹æ˜“ç†è§£åº”ç”¨ç¨‹åºä¸­çš„çŠ¶æ€ä½•æ—¶ã€ä½•åœ°ã€ä¸ºä»€ä¹ˆã€state å¦‚ä½•è¢«æ›´æ–°ï¼Œä»¥åŠå½“è¿™äº›æ›´æ”¹å‘ç”Ÿæ—¶ä½ çš„åº”ç”¨ç¨‹åºé€»è¾‘å°†å¦‚ä½•è¡¨ç°**. Redux æŒ‡å¯¼ä½ ç¼–å†™å¯é¢„æµ‹å’Œå¯æµ‹è¯•çš„ä»£ç ï¼Œè¿™æœ‰åŠ©äºä½ ç¡®ä¿¡ä½ çš„åº”ç”¨ç¨‹åºå°†æŒ‰é¢„æœŸå·¥ä½œã€‚

## æˆ‘ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ Reduxâ“

Redux å¯å¸®åŠ©ä½ å¤„ç†å…±äº«çŠ¶æ€çš„ç®¡ç†ï¼Œä½†ä¸ä»»ä½•å·¥å…·ä¸€æ ·ï¼Œå®ƒä¹Ÿéœ€è¦æƒè¡¡åˆ©å¼Šã€‚ä½¿ç”¨ Redux æœ‰æ›´å¤šçš„æ¦‚å¿µéœ€è¦å­¦ä¹ ï¼Œè¿˜æœ‰æ›´å¤šçš„ä»£ç éœ€è¦ç¼–å†™ï¼Œéœ€è¦æ·»åŠ ä¸€äº›é¢å¤–ä»£ç ï¼Œå¹¶è¦æ±‚ä½ éµå¾ªæŸäº›é™åˆ¶ã€‚è¿™æ˜¯çŸ­æœŸå’Œé•¿æœŸç”Ÿäº§åŠ›ä¹‹é—´çš„æƒè¡¡ã€‚

åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨ Reduxï¼š

- åº”ç”¨ä¸­æœ‰å¾ˆå¤š state åœ¨å¤šä¸ªç»„ä»¶ä¸­éœ€è¦ä½¿ç”¨
- åº”ç”¨ state ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œé¢‘ç¹æ›´æ–°
- æ›´æ–° state çš„é€»è¾‘å¾ˆå¤æ‚
- ä¸­å‹å’Œå¤§å‹ä»£ç é‡çš„åº”ç”¨ï¼Œå¾ˆå¤šäººååŒå¼€å‘

> **æ³¨æ„ï¼šå¹¶éæ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½éœ€è¦ Reduxã€‚**

## Redux åº“å’Œå·¥å…·æœ‰å“ªäº›â“

Redux æ˜¯ä¸€ä¸ªå°å‹çš„ç‹¬ç«‹ JS åº“ã€‚ ä½†æ˜¯ï¼Œå®ƒé€šå¸¸ä¸å…¶ä»–å‡ ä¸ªåŒ…ä¸€èµ·ä½¿ç”¨ï¼š

- **React-Redux**

  Redux å¯ä»¥é›†æˆåˆ°ä»»ä½•çš„ UI æ¡†æ¶ä¸­ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ˜¯ React ã€‚[**React-Redux**](https://cn.react-redux.js.org/) æ˜¯å®˜æ–¹åŒ…ï¼Œå®ƒå¯ä»¥è®© React ç»„ä»¶è®¿é—® state ç‰‡æ®µå’Œ dispatch actions æ›´æ–° storeï¼Œä»è€ŒåŒ Redux é›†æˆèµ·æ¥ã€‚

- **Redux Toolkit**

  [**Redux Toolkit**](https://cn.redux-toolkit.js.org/) æ˜¯å®˜æ–¹æ¨èçš„ç¼–å†™ Redux é€»è¾‘çš„æ–¹æ³•ã€‚ å®ƒåŒ…å«å¯¹äºæ„å»º Redux åº”ç”¨ç¨‹åºå¿…ä¸å¯å°‘çš„åŒ…å’Œå‡½æ•°ã€‚ Redux Toolkit ç®€åŒ–äº†å¤§å¤šæ•° Redux ä»»åŠ¡ï¼Œé¢„é˜²äº†å¸¸è§é”™è¯¯ï¼Œå¹¶ä½¿ç¼–å†™ Redux åº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ å®¹æ˜“ã€‚
  
- **Redux DevTools** 

  [**Redux DevTools æ‰©å±•**](https://github.com/zalmoxisus/redux-devtools-extension) å¯ä»¥æ˜¾ç¤º Redux å­˜å‚¨ä¸­çŠ¶æ€éšæ—¶é—´å˜åŒ–çš„å†å²è®°å½•ã€‚è¿™å…è®¸ä½ æœ‰æ•ˆåœ°è°ƒè¯•åº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬ä½¿ç”¨å¼ºå¤§çš„æŠ€æœ¯ï¼Œå¦‚â€œæ—¶é—´æ—…è¡Œè°ƒè¯•â€ã€‚

# äºŒã€ç›¸å…³æ¦‚å¿µ

## ğŸ‘‰ ä¸å¯å˜æ€§

"Mutable" æ„ä¸º "å¯æ”¹å˜çš„"ï¼Œè€Œ "immutable" æ„ä¸ºæ°¸ä¸å¯æ”¹å˜ã€‚

JavaScript çš„å¯¹è±¡å’Œæ•°ç»„é»˜è®¤éƒ½æ˜¯ mutable çš„ã€‚ä»¥å¯¹è±¡ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘å¯ä»¥æ›´æ”¹å…¶å­—æ®µçš„å†…å®¹ã€‚

```typescript
const object = {
  name: 'å¼ ä¸‰',
  car: {
    brand: 'ä¸œé£æœ¬ç”°Â·æ€åŸŸ',
    color: 'çç ç™½',
  }
};
// -- å¯¹å¤–ä»ç„¶è¿˜æ˜¯é‚£ä¸ªå¯¹è±¡ï¼Œä½†å®ƒçš„å†…å®¹å·²ç»å˜äº†
object.car.color = 'ç‚«åŠ¨è“'; 
```

è¿™å°±æ˜¯ **æ”¹å˜** å¯¹è±¡æˆ–æ•°ç»„çš„ä¾‹å­ã€‚å†…å­˜ä¸­è¿˜æ˜¯åŸæ¥å¯¹è±¡æˆ–æ•°ç»„çš„å¼•ç”¨ï¼Œä½†é‡Œé¢çš„å†…å®¹å˜åŒ–äº†ã€‚

**å¦‚æœæƒ³è¦ä¸å¯å˜çš„æ–¹å¼æ¥æ›´æ–°ï¼Œä»£ç å¿…éœ€å…ˆå¤åˆ¶åŸæ¥çš„å¯¹è±¡ï¼Œç„¶åæ›´æ–°å®ƒçš„å¤åˆ¶ä½“**ã€‚é€šè¿‡å±•å¼€è¿ç®—ç¬¦å¯æ–¹ä¾¿å®ç°è¿™ä¸ªç›®çš„ï¼š

```typescript
const newObject = {
  ...object,
  car: {
    ...object.car,
    color: 'ç‚«åŠ¨è“',
  },
};
```

**Redux æœŸæœ›æ‰€æœ‰çŠ¶æ€æ›´æ–°éƒ½æ˜¯ä½¿ç”¨ä¸å¯å˜çš„æ–¹å¼**ã€‚

> **æç¤ºï¼š**å½“æˆ‘ä»¬é€šè¿‡ Redux Toolkit æ¥æ„å»º Redux çš„æ—¶å€™ï¼Œå…è®¸æˆ‘ä»¬åœ¨ reducers å†™ "å¯å˜" é€»è¾‘ï¼Œä½†è¿™å¹¶ä¸æ˜¯çœŸæ­£çš„æ”¹å˜ stateï¼Œ å› ä¸ºå®ƒä½¿ç”¨äº† immer åº“ï¼Œå½“ immer æ£€æµ‹åˆ° "draft state" æ”¹å˜æ—¶ï¼Œä¼šåŸºäºè¿™äº›æ”¹å˜å»åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜çš„ state

## ğŸ‘‰ å•å‘æ•°æ®æµ

æˆ‘ä»¬çŸ¥é“åœ¨ React ä¸­æ•°æ®æ˜¯å•å‘æµåŠ¨çš„ã€‚æ‰€è°“æ•°æ®å•å‘æµåŠ¨ï¼Œå°±æ˜¯è¯´æ•°æ®æ˜¯ä»æŸä¸€ä¸ªç‚¹æµå‘å¦ä¸€ä¸ªç‚¹çš„ï¼ˆè‡ªä¸Šè€Œä¸‹ï¼‰ã€‚

æˆ‘ä»¬å‡è®¾æ•°æ®ä¸­å¿ƒæ˜¯ä¸€ä¸ªè´Ÿè´£å‘è¡Œèº«ä»½è¯çš„åœ°æ–¹æ”¿åºœï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥åˆ°è¿™é‡Œæ¥é¢†å–è‡ªå·±çš„èº«ä»½è¯ï¼Œä½†æ˜¯å¦‚æœä½ å¯¹è‡ªå·±çš„èº«ä»½è¯å¤´åƒä¸æ»¡æ„ï¼Œä½ ä¸èƒ½è‡ªå·±å»æ‘å£æ‹ä¸ªåå—é’±çš„å¤§å¤´è´´è´´ä¸Šå»ï¼Œä¹Ÿä¸èƒ½è‡ªå·±ä¿®æ”¹ä¸Šé¢çš„ä¸ªäººä¿¡æ¯ï¼Œè¿™æ ·çš„èº«ä»½è¯æ˜¯ä¸è¢«æ‰¿è®¤çš„ï¼ˆå¼„ä¸å¥½å¯èƒ½è¿˜å¾—åç‰¢ï¼‰ï¼Œæ­£ç¡®çš„æ“ä½œæ–¹å¼åº”è¯¥æ˜¯ï¼Œå¸¦ç€ä½ çš„ä¿®æ”¹æ„è§ï¼Œå»åˆ°åœ°æ–¹æ”¿åºœï¼Œæ‰¾ç›¸å…³å·¥ä½œäººå‘˜å¸®ä½ é‡æ–°åŠç†ï¼ŒåŠç†å®Œä¹‹åå†å‘æ”¾ç»™ä½ ã€‚

è¿™ä¸ªä¾‹å­å½“ä¸­ï¼Œæ•°æ®ä¸­å¿ƒæˆ‘ä»¬è§†ä¸ºçˆ¶ç»„ä»¶ï¼Œèº«ä»½è¯å°±æ˜¯å­ç»„ä»¶é€šè¿‡çˆ¶ç»„ä»¶æ¥æ”¶åˆ°çš„propsï¼Œä½ ä¸èƒ½ç›´æ¥ä¿®æ”¹è‡ªå·±çš„èº«ä»½è¯ï¼Œä¹Ÿå°±æ˜¯ä½ ä¸èƒ½ç›´æ¥ä¿®æ”¹çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„propsï¼Œæ¯”å¦‚ **`this.props.name = 'æå¥½å¸…'`**ï¼Œåªèƒ½é€šçŸ¥çˆ¶ç»„ä»¶å»ä¿®æ”¹è¿™ä¸ªpropsï¼Œå³è°ƒç”¨çˆ¶ç»„ä»¶æä¾›çš„ **`changeName`** æ–¹æ³•æ¥æ“ä½œï¼Œæ¯”å¦‚ **`this.props.changeName('æå¥½å¸…')`**ï¼Œè¿™ä¸ªè¿‡ç¨‹äº‹å®ä¸Šæ˜¯ä¿®æ”¹äº†çˆ¶ç»„ä»¶çš„stateï¼Œä»è€Œä½¿å¾—å­å…ƒç´ æ¥æ”¶åˆ°çš„æ•°æ®ä¹Ÿå‘ç”Ÿäº†æ”¹å˜ã€‚

æ‰€ä»¥æ•°æ®ç”±å§‹è‡³ç»ˆéƒ½æ˜¯ä»çˆ¶å…ƒç´ æµå‘å­å…ƒç´ ï¼Œæˆ‘ä»¬ç§°ä¸º**æ•°æ®å•å‘æµåŠ¨**ã€‚

æˆ‘ä»¬å›æƒ³ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰æ„å»ºè¿‡çš„æ‰€æœ‰ Reactåº”ç”¨ï¼Œæ•°æ®éƒ½æ˜¯ç”±æœ€é¡¶å±‚çˆ¶ç»„ä»¶ï¼ˆé¡µé¢ç»„ä»¶ï¼‰ä¸€å±‚å±‚å‘ä¸‹ä¼ é€’çš„ã€‚

è¿™ä¹Ÿæ˜¯æ·±å±‚æ¬¡çš„ç»„ä»¶ä¹‹é—´é€šè®¯å›°éš¾çš„åŸå› ï¼šæ•°æ®çš„ä¼ é€’æ˜¯å•å‘çš„ï¼Œå­ç»„ä»¶çš„æ•°æ®åªèƒ½å°±è¿‘è·å–ï¼Œä½†æ˜¯çœŸæ­£çš„æ•°æ®æºå´ç¦»å¾—å¤ªè¿œï¼Œæ²¡æœ‰æ·å¾„å¯ä»¥ç›´æ¥é€šçŸ¥æ•°æ®æºæ›´æ–°çŠ¶æ€ï¼ˆå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡ `context` å®ç°ï¼‰ã€‚

Redux çš„å‡ºç°æ”¹å˜äº†React çš„è¿™ç§çª˜è¿«å¤„å¢ƒï¼Œå®ƒæä¾›äº†æ•´ä¸ªåº”ç”¨çš„å”¯ä¸€æ•°æ®æº storeï¼Œè¿™ä¸ªæ•°æ®æºæ˜¯éšå¤„å¯ä»¥è®¿é—®çš„ï¼Œä¸éœ€è¦é çˆ¶å­ç›¸ä¼ ï¼Œå¹¶ä¸”è¿˜æä¾›äº†ï¼ˆé—´æ¥ï¼‰æ›´æ–°è¿™ä¸ªæ•°æ®æºçš„æ–¹æ³•ï¼Œå¹¶ä¸”æ˜¯éšå¤„å¯ä½¿ç”¨çš„ï¼

## ğŸ‘‰ Redux æ•°æ®æµ

åˆšåˆšï¼Œæˆ‘ä»¬è°ˆåˆ°äº†â€œå•å‘æ•°æ®æµâ€ï¼Œç°åœ¨æˆ‘ä»¬æ¥èŠèŠ Redux çš„æ•°æ®æµã€‚

å…·ä½“æ¥è¯´ï¼Œå¯¹äº Reduxï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ­¥éª¤åˆ†è§£ä¸ºæ›´è¯¦ç»†çš„å†…å®¹ï¼š

- åˆå§‹å¯åŠ¨ï¼š
  - ä½¿ç”¨æœ€é¡¶å±‚çš„ root reducer å‡½æ•°åˆ›å»º Redux store
  - store è°ƒç”¨ä¸€æ¬¡ root reducerï¼Œå¹¶å°†è¿”å›å€¼ä¿å­˜ä¸ºå®ƒçš„åˆå§‹ `state`
  - å½“ UI é¦–æ¬¡æ¸²æŸ“æ—¶ï¼ŒUI ç»„ä»¶è®¿é—® Redux store çš„å½“å‰ stateï¼Œå¹¶ä½¿ç”¨è¯¥æ•°æ®æ¥å†³å®šè¦å‘ˆç°çš„å†…å®¹ã€‚åŒæ—¶ç›‘å¬ store çš„æ›´æ–°ï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥çŸ¥é“ state æ˜¯å¦å·²æ›´æ”¹ã€‚
- æ›´æ–°ç¯èŠ‚ï¼š
  - åº”ç”¨ç¨‹åºä¸­å‘ç”Ÿäº†æŸäº›äº‹æƒ…ï¼Œä¾‹å¦‚ç”¨æˆ·å•å‡»æŒ‰é’®
  - dispatch ä¸€ä¸ª action åˆ° Redux storeï¼Œä¾‹å¦‚ `dispatch({type: 'counter/increment'})`
  - store ç”¨ä¹‹å‰çš„ `state` å’Œå½“å‰çš„ `action` å†æ¬¡è¿è¡Œ reducer å‡½æ•°ï¼Œå¹¶å°†è¿”å›å€¼ä¿å­˜ä¸ºæ–°çš„ `state`
  - store é€šçŸ¥æ‰€æœ‰è®¢é˜…è¿‡çš„ UIï¼Œé€šçŸ¥å®ƒä»¬ store å‘ç”Ÿæ›´æ–°
  - æ¯ä¸ªè®¢é˜…è¿‡ store æ•°æ®çš„ UI ç»„ä»¶éƒ½ä¼šæ£€æŸ¥å®ƒä»¬éœ€è¦çš„ state éƒ¨åˆ†æ˜¯å¦è¢«æ›´æ–°ã€‚
  - å‘ç°æ•°æ®è¢«æ›´æ–°çš„æ¯ä¸ªç»„ä»¶éƒ½å¼ºåˆ¶ä½¿ç”¨æ–°æ•°æ®é‡æ–°æ¸²æŸ“ï¼Œç´§æ¥ç€æ›´æ–°ç½‘é¡µ

åŠ¨ç”»çš„æ–¹å¼æ¥è¡¨è¾¾æ•°æ®æµæ›´æ–°ï¼š

<img src="./IMGs/ReduxDataFlowDiagram.gif" style="zoom: 33%;" />



# ä¸‰ã€ä¸‰å¤§åŸåˆ™

1. å•ä¸€æ•°æ®æº

2. State æ˜¯åªè¯»çš„ 

3. ä½¿ç”¨ reducer çº¯å‡½æ•°è¿›è¡Œæ›´æ”¹

åº”ç”¨çš„æ•´ä½“å…¨å±€çŠ¶æ€ä»¥å¯¹è±¡æ ‘çš„æ–¹å¼å­˜æ”¾äºå•ä¸ª *store*ã€‚ å”¯ä¸€æ”¹å˜çŠ¶æ€æ ‘ï¼ˆstate treeï¼‰çš„æ–¹æ³•æ˜¯åˆ›å»º *action*ï¼Œä¸€ä¸ªæè¿°å‘ç”Ÿäº†ä»€ä¹ˆçš„å¯¹è±¡ï¼Œå¹¶å°†å…¶ *dispatch* ç»™ storeã€‚ è¦æŒ‡å®šçŠ¶æ€æ ‘å¦‚ä½•å“åº” action æ¥è¿›è¡Œæ›´æ–°ï¼Œä½ å¯ä»¥ç¼–å†™çº¯ *reducer* å‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ ¹æ®æ—§ state å’Œ action æ¥è®¡ç®—æ–° stateã€‚

# å››ã€Redux æœ¯è¯­

## 1. Actions

**Action** æ˜¯ä¸€ä¸ªç”¨äºæè¿°å·²å‘ç”Ÿäº‹ä»¶çš„ **æ™®é€š JavaScript å¯¹è±¡**ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ â€œä½ å¹²äº†ä¸€ä»¶ä»€ä¹ˆäº‹æƒ…â€ã€‚ä½†æ˜¯å•å•è®²äº†ä½ å¹²çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“ä½ å¹²çš„è¿™ä»¶äº‹äº§ç”Ÿäº†ä»€ä¹ˆç‰›é€¼æ•ˆæœï¼Œäºæ˜¯æœ‰äº†ä¸€ä¸ªä¸“é—¨è´Ÿè´£æè¿°æŸä¸ªaction å¯¹åº”äº§ç”ŸæŸç§æ•ˆæœçš„æœºæ„ï¼Œå«åš Reducerã€‚

æˆ‘ä»¬çº¦å®šï¼Œaction çš„ç±»å‹å¦‚ä¸‹æ‰€ç¤ºï¼š

```typescript
interface PayloadAction<T = any> {
  type: string;
  payload: T;
}
```

è¯­æ³•è§£è¯»ï¼š

- `type`ï¼šè¡¨ç¤ºå°†è¦æ‰§è¡Œçš„åŠ¨ä½œï¼Œæ¯”å¦‚ `todos/todoAdded`ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠé‚£ä¸ªç±»å‹çš„å­—ç¬¦ä¸²å†™æˆ ã€Œ**åŸŸ/äº‹ä»¶åç§°**ã€çš„å½¢å¼ï¼Œå…¶ä¸­ç¬¬ä¸€éƒ¨åˆ†æ˜¯è¿™ä¸ª action æ‰€å±çš„ç‰¹å¾æˆ–ç±»åˆ«ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯å‘ç”Ÿçš„å…·ä½“äº‹æƒ…ã€‚
- `payload`ï¼šæ‰€éœ€çš„å‚æ•°ï¼Œæ¯”å¦‚  `todos/todoAdded` è¡¨ç¤ºæ·»åŠ ä¸€ä¸ªå¾…åŠäº‹é¡¹ï¼Œé‚£å¾…åŠäº‹é¡¹çš„å…·ä½“å†…å®¹å¯ä»¥é€šè¿‡ payload ä¼ é€’ã€‚

ä¸€ä¸ªå…¸å‹çš„ action å¯¹è±¡å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š

```js
const addTodoAction = {
  type: 'todos/todoAdded',
  payload: 'Learn to program.'
}
```

**ğŸ‘‰ Action-Creators**

 Action-Creators æ˜¯ä¸€ä¸ªåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª action å¯¹è±¡çš„å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®©ä½ ä¸å¿…æ¯æ¬¡éƒ½æ‰‹åŠ¨ç¼–å†™ action å¯¹è±¡ï¼š

```typescript
export const todoAdded = (todoText: string) => ({
  type: 'todos/todoAdded',
  payload: todoText,
});
```

## 2. Reducers

**Reducer** æ˜¯ä¸€ä¸ªæ¥æ”¶å½“å‰çš„ `state` å’Œ `action`ï¼Œå¿…è¦æ—¶å†³å®šå¦‚ä½•æ›´æ–°çŠ¶æ€ï¼Œå¹¶è¿”å›æ–°çš„çŠ¶æ€çš„çº¯å‡½æ•°ï¼Œå‡½æ•°çš„ç­¾åæ˜¯ï¼š

```tsx
(state, action) => newState
```

ä½ å¯ä»¥å°† Reducer è§†ä¸ºä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œå®ƒæ ¹æ®æ¥æ”¶åˆ°çš„ actionï¼ˆäº‹ä»¶ï¼‰ç±»å‹å¤„ç†äº‹ä»¶ã€‚

Reducer å¿…éœ€ç¬¦åˆä»¥ä¸‹è§„åˆ™ï¼š

- ä»…ä½¿ç”¨ `state` å’Œ `action` å‚æ•°è®¡ç®—æ–°çš„çŠ¶æ€å€¼ã€‚
- ç¦æ­¢ç›´æ¥ä¿®æ”¹ `state`ã€‚å¿…é¡»é€šè¿‡å¤åˆ¶ç°æœ‰çš„ `state` å¹¶å¯¹å¤åˆ¶çš„å€¼è¿›è¡Œæ›´æ”¹çš„æ–¹å¼æ¥åš **ä¸å¯å˜æ›´æ–°**ã€‚
- ç¦æ­¢ä»»ä½•å¼‚æ­¥é€»è¾‘ã€ä¾èµ–éšæœºå€¼æˆ–å¯¼è‡´å…¶ä»–â€œå‰¯ä½œç”¨â€çš„ä»£ç ã€‚

Reducer å‡½æ•°å†…éƒ¨çš„é€»è¾‘é€šå¸¸éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

- æ£€æŸ¥ reducer æ˜¯å¦å…³å¿ƒè¿™ä¸ª action
  - å¦‚æœæ˜¯ï¼Œåˆ™å¤åˆ¶ stateï¼Œä½¿ç”¨æ–°å€¼æ›´æ–° state å‰¯æœ¬ï¼Œç„¶åè¿”å›æ–° state
- å¦åˆ™ï¼Œè¿”å›åŸæ¥çš„ state ä¸å˜

## 3. Store

[**store**](https://cn.redux.js.org/api/store) æ˜¯ Redux æä¾›çš„ **å”¯ä¸€** æ•°æ®æºï¼Œå®ƒå­˜å‚¨äº†æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ã€‚store æ˜¯é€šè¿‡ä¼ å…¥ä¸€ä¸ª reducer æ¥åˆ›å»ºçš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```typescript
import { configureStore } from '@reduxjs/toolkit'
const store = configureStore({ reducer: counterReducer });
console.log(store.getState()); // â†’ {value: 0}
```

Store æœ‰ä»¥ä¸‹èŒè´£ï¼š

- åœ¨å†…éƒ¨ä¿å­˜å½“å‰åº”ç”¨ç¨‹åº state
- é€šè¿‡ [`store.getState()`](https://cn.redux.js.org/api/store#getState) è®¿é—®å½“å‰ state;
- é€šè¿‡ [`store.dispatch(action)`](https://cn.redux.js.org/api/store#dispatch) æ›´æ–°çŠ¶æ€;
- é€šè¿‡ [`store.subscribe(listener)`](https://cn.redux.js.org/api/store#subscribe) æ³¨å†Œç›‘å¬å™¨å›è°ƒ;
- é€šè¿‡ [`store.subscribe(listener)`](https://cn.redux.js.org/api/store#subscribe) è¿”å›çš„ `unsubscribe` å‡½æ•°æ³¨é”€ç›‘å¬å™¨ã€‚

> æ³¨æ„ï¼šstoreæ˜¯åªè¯»çš„ï¼ŒRedux æ²¡æœ‰æä¾›ç›´æ¥ä¿®æ”¹æ•°æ®çš„æ–¹æ³•ï¼Œæ”¹å˜stateçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯è§¦å‘ï¼ˆ**dispatch**ï¼‰ **action** ã€‚

## 4. Dispatch

Redux store æœ‰ä¸€ä¸ªæ–¹æ³•å« `dispatch`ã€‚**æ›´æ–° state çš„å”¯ä¸€æ–¹æ³•æ˜¯è°ƒç”¨ `store.dispatch()` å¹¶ä¼ å…¥ä¸€ä¸ª action å¯¹è±¡**ã€‚store å°†æ‰§è¡Œæ‰€æœ‰ reducer å‡½æ•°å¹¶è®¡ç®—å‡ºæ›´æ–°åçš„ stateï¼Œè°ƒç”¨ `getState()` å¯ä»¥è·å–æ–° stateã€‚

```typescript
store.dispatch({ type: 'counter/increment' });
console.log(store.getState()); // â†’ {value: 1}
```

**dispatch ä¸€ä¸ª action å¯ä»¥å½¢è±¡çš„ç†è§£ä¸º "è§¦å‘ä¸€ä¸ªäº‹ä»¶"**ã€‚å‘ç”Ÿäº†ä¸€äº›äº‹æƒ…ï¼Œæˆ‘ä»¬å¸Œæœ› store çŸ¥é“è¿™ä»¶äº‹ã€‚ Reducer å°±åƒäº‹ä»¶ç›‘å¬å™¨ä¸€æ ·ï¼Œå½“å®ƒä»¬æ”¶åˆ°å…³æ³¨çš„ action åï¼Œå®ƒå°±ä¼šæ›´æ–° state ä½œä¸ºå“åº”ã€‚

ä»¬é€šå¸¸è°ƒç”¨ action creator æ¥è°ƒç”¨ actionï¼š

```typescript
const increment = () => ({
  type: 'counter/increment'
});
store.dispatch(increment());
console.log(store.getState()); // â†’ {value: 2}
```

## 5. Selectors

**Selector** å‡½æ•°å…è®¸æˆ‘ä»¬ä» state ä¸­è¯»å–æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```typescript
// â†’ xxxSlice.ts
export const selectCount = (state: RootState) => state.counter.value;
```

åœ¨ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¿é—®ï¼š

```tsx
import { useSelector } from 'react-redux';
const count = useSelector(selectCount);
```

ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨çš„åœ°æ–¹ä»¥å†…è”çš„æ–¹å¼å®šä¹‰ï¼š

```typescript
const count = useSelector((state: RootState) => state.counter.value)
```

## 6. Redux Slice

**ğŸ‘‰  [Redux-Toolkit >>](https://cn.redux-toolkit.js.org/)**

**â€œSliceâ€ æ˜¯åº”ç”¨ä¸­å•ä¸ªåŠŸèƒ½çš„ Redux-Reducer é€»è¾‘å’Œ action çš„é›†åˆ**ï¼Œé€šå¸¸ä¸€èµ·å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¯¥åç§°æ¥è‡ªäºå°†æ ¹ Redux çŠ¶æ€å¯¹è±¡æ‹†åˆ†ä¸ºå¤šä¸ªçŠ¶æ€ â€œsliceâ€ã€‚

æ¯”å¦‚ï¼Œåœ¨ä¸€ä¸ªåšå®¢åº”ç”¨ä¸­ï¼Œstore çš„é…ç½®å¤§è‡´é•¿è¿™æ ·ï¼š

```typescript
import { configureStore } from '@reduxjs/toolkit'
import usersReducer from '@/store/slices/usersSlice'
import postsReducer from '@/store/slices/postsSlice'
import commentsReducer from '@/store/slices/commentsSlice'

export default configureStore({
  reducer: {
    users: usersReducer,
    posts: postsReducer,
    comments: commentsReducer
  }
})
```

ä¾‹å­ä¸­ï¼Œ`state.users`ï¼Œ`state.posts`ï¼Œå’Œ `state.comments` å‡æ˜¯ Redux state çš„ä¸€ä¸ª ç‹¬ç«‹çš„ â€œsliceâ€ã€‚ç”±äº `usersReducer` è´Ÿè´£æ›´æ–° `state.users` sliceï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸º â€œslice reducerâ€ å‡½æ•°ã€‚

## 7. Thunk Functions

Redux store æœ¬èº«æ— æ³•å¤„ç†å¼‚æ­¥é€»è¾‘ã€‚å®ƒåªä¼šåŒæ­¥åœ° dispatch actionï¼Œå¹¶é€šè¿‡è°ƒç”¨æ ¹ reducer å‡½æ•°æ¥æ›´æ–° stateï¼Œç„¶åé€šçŸ¥è§†å›¾æ›´æ–°ã€‚è€ŒReducer æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œç¦æ­¢ä¸€åˆ‡ **å‰¯ä½œç”¨** æ“ä½œï¼Œä»»ä½•å¼‚æ­¥éƒ½å¿…é¡»åœ¨ store ä¹‹å¤–å‘ç”Ÿã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºé€šå¸¸å…·æœ‰å¼‚æ­¥é€»è¾‘ï¼Œæ¯”å¦‚ä» API è¯·æ±‚æ•°æ®ä¹‹ç±»çš„äº‹æƒ…ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦ä¸€ä¸ªåœ°æ–¹ä¸“é—¨å¤„ç†å¼‚æ­¥é€»è¾‘ï¼Œ**ä¸­é—´ä»¶** å°±æ˜¯ç”¨æ¥æ”¾è¿™äº›å‰¯ä½œç”¨é€»è¾‘ä»£ç çš„åœ°æ–¹ã€‚

Reudx å¼‚æ­¥æ“ä½œç»å†äº†ä¸‰ä¸ªé˜¶æ®µï¼š`Redux Middlewares` â†’ `redux-chunk` â†’ `Redux Toolkit`

ä¸‹é¢æˆ‘ä»¬å°†é€ä¸€è¯´æ˜å„é˜¶æ®µçš„ç”¨æ³•ã€‚

### Middlewares

ä¸‹é¢æ˜¯å‡ ä¸ªç¤ºä¾‹ï¼Œç”¨æ¥è¯´æ˜ middleware å¦‚ä½•ä½¿æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™ä¸ Redux store äº¤äº’çš„å¼‚æ­¥é€»è¾‘ã€‚

ä¸€ä¸ªå¥‘æœºæ˜¯ç¼–å†™ middleware æ¥æŸ¥æ‰¾ç‰¹å®šçš„ action typeï¼Œå¹¶åœ¨æ‰§è¡Œè¿™äº› action æ—¶è¿è¡Œå¼‚æ­¥é€»è¾‘ï¼Œä¾‹å¦‚ä»¥ä¸‹ç¤ºä¾‹ï¼š

```typescript
import { client } from '@/api/client'
// â†’ Examples 1
const delayedActionMiddleware = storeAPI => next => action => {
  if (action.type === 'todos/todoAdded') {
    setTimeout(() => {
      // -- å°†è¿™ä¸ª action å»¶è¿Ÿ1ç§’æ‰§è¡Œ
      next(action)
    }, 1000)
    return
  }
  return next(action)
}
// â†’ Exmaples 2
const fetchTodosMiddleware = storeAPI => next => action => {
  if (action.type === 'todos/fetchTodos') {
    // -- å‘é€ API ä»æœåŠ¡å™¨è·å– todos
    client.get('todos').then(todos => {
      // -- ä½¿ç”¨è·å–åˆ°çš„ todos æ•°æ®æ¥ dispatch ä¸€ä¸ª action
      storeAPI.dispatch({ type: 'todos/todosLoaded', payload: todos })
    })
  }
  return next(action)
}
```

è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®æœ‰è‹¥å¹²ä¸ªå¼‚æ­¥å¤„ç†ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ç¼–å†™è‹¥å¹²ä¸ªä¸­é—´ï¼Œå¦‚æœæœ‰åŠæ³•å¯ä»¥æå‰ç¼–å†™ ä»»ä½• å¼‚æ­¥é€»è¾‘ï¼Œä¸ä½†ä¸ middleware æœ¬èº«åˆ†å¼€ï¼Œè€Œä¸”ä»ç„¶å¯ä»¥è®¿é—® `dispatch` å’Œ `getState` æ¥å’Œ store è¿›è¡Œäº¤äº’ï¼Œé‚£å°±å¤ªå¥½äº†ã€‚

**å‡è®¾æˆ‘ä»¬å®ç°è¿™æ ·çš„ middlewareï¼Œå®ƒå¯ä»¥ä¼ é€’ å‡½æ•° ç»™ dispatchï¼Œè€Œä¸æ˜¯ action å¯¹è±¡å‘¢ï¼Ÿ**å¯ä»¥è®©è¿™ä¸ª middleware åˆ¤æ–­ action æ˜¯å¦ä¸ºå‡½æ•°ï¼Œå¦‚æœæ˜¯å‡½æ•°ï¼Œå°±ç«‹å³è°ƒç”¨ã€‚è¿™æ ·å°±å¯ä»¥åœ¨ middleware å®šä¹‰ä¹‹å¤–çš„å…¶ä»–å‡½æ•°ä¸­ç¼–å†™å¼‚æ­¥é€»è¾‘äº†ã€‚

middleware çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```typescript
import { Middleware } from 'redux';
export const asyncMiddleware: Middleware = (storeApi) => (next) => (action) => {
  if (typeof action === 'function') {
    // â†’ å¦‚æœä¼ å…¥çš„actionæ˜¯ä¸€ä¸ªå‡½æ•°
    // â†’ è°ƒç”¨è¯¥å‡½æ•°å¹¶ä¼ å…¥ dispatch å’Œ getState ä½œä¸ºå‚æ•°
    return action(storeApi.dispatch, storeApi.getState);
  } else {
    // â†’ å¦åˆ™ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€š actionï¼Œé‚£å°±ç»§ç»­æ‰§è¡Œ
    return next(action);
  }
};
```
ç„¶åå°±å¯ä»¥åƒè¿™æ ·ä½¿ç”¨è¯¥ middlewareï¼š

```typescript
// ğŸ‘‰ ä»£ç ç‰‡æ®µ1ï¼šæ³¨å†Œä¸­é—´ä»¶
const store = createStore(rootReducer, applyMiddleware(asyncMiddleware) /* æ³¨å†Œä¸­é—´ä»¶*/);

// ğŸ‘‰ ä»£ç ç‰‡æ®µ2ï¼šç¼–å†™ä¸€ä¸ªæ¥æ”¶ dispatch å’Œ getState ä½œä¸ºå‚æ•°çš„å‡½æ•°
const fetchSomeData = (dispatch, getState) => {
  client.get('todos').then(todos => { // â†’ å‘é€ä¸€ä¸ªå¼‚æ­¥ HTTP è¯·æ±‚
    // â†’ ä½¿ç”¨è·å–çš„ todos æ¥ dispatch action
    dispatch({ type: 'todos/todosLoaded', payload: todos })
    // â†’ dispatch åæ£€æŸ¥æ›´æ–°åçš„ store
    const allTodos = getState().todos
    console.log('Number of todos after loading: ', allTodos.length)
  })
}

// ğŸ‘‰ ä»£ç ç‰‡æ®µ3ï¼šå‘ dispatch ä¼ å…¥å‡½æ•°
store.dispatch(fetchSomeData);
```

> **æ³¨æ„ï¼š** **è¿™ä¸ªå¼‚æ­¥å‡½æ•° middleware ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç»™ `dispatch` ä¼ å…¥å‡½æ•° ï¼**åœ¨è¯¥å‡½æ•°ä¸­ï¼Œå¯ä»¥ç¼–å†™ä¸€äº›å¼‚æ­¥é€»è¾‘ï¼ˆæ¯”å¦‚ HTTP è¯·æ±‚ï¼‰ï¼Œç„¶ååœ¨è¯·æ±‚å®Œæˆå dispatch ä¸€ä¸ªæ™®é€šçš„ actionã€‚

### Redux-thunk

ç›®å‰ï¼ŒRedux å·²ç»æœ‰äº†å¼‚æ­¥å‡½æ•° middleware çš„æ­£å¼ç‰ˆæœ¬ï¼Œç§°ä¸º [**Redux â€œThunkâ€ middleware**](https://github.com/reduxjs/redux-thunk)ã€‚thunk middleware å…è®¸æˆ‘ä»¬ç¼–å†™ä»¥ `dispatch` å’Œ `getState` ä½œä¸ºå‚æ•°çš„å‡½æ•°ã€‚thunk å‡½æ•°å¯ä»¥åŒ…å«æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•å¼‚æ­¥é€»è¾‘ï¼Œå¹¶ä¸”è¯¥é€»è¾‘å¯ä»¥æ ¹æ®éœ€è¦ dispatch action ä»¥åŠè¯»å– store stateã€‚

**thunk** æ˜¯ä¸€ç§ç‰¹å®šç±»å‹çš„ Redux å‡½æ•°ï¼Œå¯ä»¥åŒ…å«å¼‚æ­¥é€»è¾‘ã€‚ä¸Šä¸€å°èŠ‚ä¸­çš„ `fetchSomeData` å‡½æ•°å°±æ˜¯ä¸€ä¸ª Thunk.

å®é™…åº”ç”¨ä¸­ï¼Œ Thunk æ˜¯ä½¿ç”¨ä¸¤ä¸ªå‡½æ•°ç¼–å†™çš„ï¼š

- ä¸€ä¸ªå†…éƒ¨ thunk å‡½æ•°ï¼Œå®ƒä»¥ `dispatch` å’Œ `getState` ä½œä¸ºå‚æ•° â†’ *çœŸæ­£çš„Thunkå‡½æ•°*
- å¤–éƒ¨åˆ›å»ºè€…å‡½æ•°ï¼Œå®ƒåˆ›å»ºå¹¶è¿”å› thunk å‡½æ•° â†’ *é€šè¿‡å¤–éƒ¨åˆ›å»ºå‡½æ•°ï¼Œå¯ä»¥å®ç°å‚æ•°çš„ä¼ é€’*

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```typescript
export const incrementAsync = (amount) => async (dispatch, getState) => {
  console.log('Loading...');
  // â†’ æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
  const data = await new Promise((resolve) => {
    setTimeout(() => resolve(amount + 1), 2000);
  });
  // â†’ å½“å¼‚æ­¥ä»£ç æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œå¯ä»¥ dispatched actions
  dispatch({ type: 'counter/incrementByAmount', payload: data });
  console.log('completed!');
};
// â†’ æˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨æ™®é€š Redux action creator ä¸€æ ·ä½¿ç”¨å®ƒä»¬
store.dispatch(incrementAsync(10));
```

å½“ä½ éœ€è¦è¯·æ±‚åç«¯æœåŠ¡æ—¶ï¼Œä½ å¯ä»¥å°†è¯¥è°ƒç”¨æ”¾å…¥ thunk ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªå†™å¾—æœ‰ç‚¹é•¿çš„ä¾‹å­ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•å®šä¹‰çš„ï¼š

```typescript
// â†’  å¤–éƒ¨çš„ thunk creator å‡½æ•°
function fetchUserById(userId: string) {
  // â†’  å†…éƒ¨çš„ thunk å‡½æ•°
  return async function (dispatch: Dispatch) {
    try {
      // â†’  thunk å†…å‘èµ·å¼‚æ­¥æ•°æ®è¯·æ±‚
      const user = await userAPI.fetchById(userId);
      // â†’  æ•°æ®å“åº”å®Œæˆå dispatch ä¸€ä¸ª action
      dispatch(userLoaded(user));
    } catch (err) {
      // â†’ å¦‚æœè¿‡ç¨‹å‡ºé”™ï¼Œåœ¨è¿™é‡Œå¤„ç†
    }
  };
}
```

**ğŸ‘‰ é…ç½®Store**

Redux thunk middleware åœ¨ NPM ä¸Šä½œä¸ºä¸€ä¸ªåä¸º redux-thunk çš„åŒ…æä¾›ã€‚éœ€è¦å®‰è£…è¯¥è½¯ä»¶åŒ…åæ‰èƒ½åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼š

```shell
$ npm install redux-thunk
```

å®‰è£…åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Redux store ä¸­ä½¿ç”¨è¯¥ middlewareï¼š

```typescript
import { AnyAction, applyMiddleware, createStore } from 'redux';
import { rootReducer } from './reducers';
import thunkMiddleware from 'redux-thunk';
import type { ThunkAction, ThunkMiddleware } from 'redux-thunk';

const store = createStore(
  rootReducer,
  applyMiddleware(thunkMiddleware as ThunkMiddleware) /* æ³¨å†Œä¸­é—´ä»¶*/
);

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
export type AppThunk<ReturnType = void> = ThunkAction<ReturnType, RootState, unknown, AnyAction>;

export default store;
```

# å…­ã€React-Reduxï¼ˆäº†è§£ï¼‰

## Use-in-js

![](./IMGs/redux_basics.gif)

æˆ‘ä»¬é¦–å…ˆé€šè¿‡ Counter ç¤ºä¾‹å¸®åŠ©å¤§å®¶äº†è§£ Redux åœ¨ JavaScript ä¸­çš„åº”ç”¨ã€‚

### 1. åˆ›å»ºé¡¹ç›®

```shell
$ mkdir redux-basics && cd redux-basics && touch index.css index.html index.js && code .
```

### 2. ç¼–å†™ä»£ç 

**ğŸ‘‰  ` index.js`**

```javascript
// ğŸ‘‰ Get DOMs
const $ = (sel) => document.querySelector(sel);

// ğŸ‘‰ Actions creators
const increment = () => ({ type: 'counter/increment' });
const decrement = () => ({ type: 'counter/decrement' });
const incrementByAmount = (amount) => ({
  type: 'counter/incrementByAmount',
  payload: amount,
});
const toggleStatus = () => ({ type: 'status/toggleStatus' });

// ğŸ‘‰ Reduers
const counterReducer = (state = { count: 6 }, action) => {
  switch (action.type) {
    case 'counter/increment':
      return { ...state, count: state.count + 1 };
    case 'counter/decrement':
      return { ...state, count: state.count - 1 };
    case 'counter/incrementByAmount':
      return { ...state, count: state.count + action.payload };
    default:
      return state;
  }
};
const statusReducer = (state = { loading: false }, action) => {
  switch (action.type) {
    case 'status/toggleStatus':
      return { ...state, loading: !state.loading };
    default:
      return state;
  }
};

// ğŸ‘‰ Middlewares - ä¸­é—´ä»¶
// -- è§¦å‘æµç¨‹ï¼šdispatch â†’ ä¸­é—´ä»¶ â†’ reducers
// -- ä¸­é—´ä»¶ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨Reduxä¸­è¿›è¡Œå‰¯ä½œç”¨æ“ä½œ
// -- é€šå¸¸ä½ ä¸å¿…å•ç‹¬ä¸ºæŸä¸€ä¸ªåŠŸèƒ½æ„å»ºä¸­é—´ä»¶ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„å¼‚æ­¥ä¸­é—´ä»¶æ¥å¤„ç†é¡¹ç›®ä¸­çš„å¼‚æ­¥æ“ä½œ
// -- ä½¿ç”¨æ—¶ä½ éœ€è¦å…ˆç”³è¯·ä¸­é—´ä»¶å¢å¼ºå™¨ï¼Œç„¶ååœ¨åˆ›å»ºstoreçš„æ—¶å€™ä¼ å…¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
// -- 1. const middlewareEnhancer = Redux.applyMiddleware(xxxMiddleware)
// -- 2. const store = Redux.createStore(reducer, middlewareEnhancer)
const asyncFunctionMiddleware = (storeApi) => (next) => (action) => {
  if (typeof action === 'function') {
    // â†’ å¦‚æœä¼ å…¥çš„actionæ˜¯ä¸€ä¸ªå‡½æ•°
    // â†’ è°ƒç”¨è¯¥å‡½æ•°å¹¶ä¼ å…¥ dispatch å’Œ getState ä½œä¸ºå‚æ•°
    return action(storeApi.dispatch, storeApi.getState);
  } else {
    // â†’ å¦åˆ™ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€š actionï¼Œé‚£å°±ç»§ç»­æ‰§è¡Œ
    return next(action);
  }
};

// ğŸ‘‰ Create store
// â†’ æ³¨å†Œä¸­é—´ä»¶
const middlewareEnhancer = Redux.applyMiddleware(asyncFunctionMiddleware);
// â†’ åˆå¹¶reducers
const reducer = Redux.combineReducers({
  counter: counterReducer,
  status: statusReducer,
});
const store = Redux.createStore(reducer, middlewareEnhancer);

// ğŸ‘‰ Selectors
const useSelector = (fn) => {
  return fn(store.getState());
};

//  ğŸ‘‰ CHUNKs - å¼‚æ­¥å‡½æ•°
const incrementAsync = (amount) => async (dispatch, getState) => {
  const isLoading = getState().status.loading;
  if (isLoading) {
    return console.log('å½“å‰æ­£åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œè¯·ç¨åå†è¯•...');
  }
  dispatch(toggleStatus());
  await new Promise((resolve) => {
    console.log('Loading...');
    setTimeout(() => {
      resolve();
    }, 1000);
  });
  dispatch(toggleStatus());
  dispatch(incrementByAmount(amount));
  console.log('Completed!');
};

// ğŸ‘‰ Render functions
const render = () => {
  const count = useSelector((state) => state.counter.count);
  $('#value').textContent = count;
};
// â†’ è®¢é˜…Storeæ›´æ–°
store.subscribe(render);

// ğŸ‘‰ Events - Dispatchs
$('#increment').onclick = () => store.dispatch(increment());
$('#decrement').onclick = () => store.dispatch(decrement());
$('#addAmount').onclick = () => {
  const value = $('#textbox').value;
  store.dispatch(incrementByAmount(Number(value) || 0));
};
$('#asyncButton').onclick = () => {
  const value = $('#textbox').value;
  store.dispatch(incrementAsync(Number(value) || 0));
};

// ğŸ‘‰ Enter Actions...
$('#textbox').value = 2;
render();
```

**ğŸ‘‰  ` index.html`**

```html
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./index.css" />
    <title>Redux basic example</title>
    <script src="https://unpkg.com/redux@latest/dist/redux.min.js"></script>
  </head>
  <body>
    <div class="app">
      <div class="row">
        <button class="button" id="increment">+</button>
        <span class="value" id="value">0</span>
        <button class="button" id="decrement">-</button>
      </div>
      <div class="row">
        <input class="textbox" id="textbox" />
        <button class="button" id="addAmount">Add Amount</button>
        <button class="button asyncButton" id="asyncButton">Add Async</button>
      </div>
    </div>
    <script src="./index.js"></script>
  </body>
</html>
```

**ğŸ‘‰  ` index.css`**

```css
.app { height: 100vh; padding-top: 100px; }

.row { display: flex; align-items: center; justify-content: center; margin-bottom: 16px; }
.button {
  font-size: 32px;
  padding: 4px 12px;
  border: 2px solid transparent;
  color: rgb(112, 76, 182);
  cursor: pointer;
  background-color: rgba(112, 76, 182, 0.1);
  border-radius: 10px;
  transition: all 0.15s;
}

.button:hover,
.button:focus  { border: 2px solid rgba(112, 76, 182, 0.4); }
.button:active { background-color: rgba(112, 76, 182, 0.2); }

.value { font-size: 78px; padding: 0 16px; font-family: 'Courier New', Courier, monospace; }

.textbox {
  font-size: 32px;
  padding: 4px;
  width: 64px;
  text-align: center;
  margin-right: 8px;
  border-radius: 10px;
}

.asyncButton { position: relative; margin-left: 8px; overflow: hidden; }
.asyncButton:after {
  content: '';
  display: block;
  width: 100%;
  height: 100%;
  background-color: rgba(112, 76, 182, 0.15);
  position: absolute;
  left: 0;
  top: 0;
  opacity: 0;
  transition: width 1s linear, opacity 0.5s ease 1s;
}
.asyncButton:active:after { width: 0%; opacity: 1; transition: 0s; }
```

## Use-in-React-Class

### å‰ç½®çŸ¥è¯†

åœ¨ React ä¸­ä½¿ç”¨ Reduxï¼Œä¸»è¦åŸºäº `react-redux` åº“å®ç°ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å…³äº React-Class-Component ç›¸å…³çš„çŸ¥è¯†ã€‚

> *æç¤ºï¼šç°å¦‚ä»Šï¼ŒHooks ç››è¡Œï¼ŒåŸºæœ¬ä¸Šæˆ‘ç°åœ¨å¼€å‘çš„é¡¹ç›®éƒ½æ˜¯åŸºäº React-Hooks + TypeScript å®ç°çš„ï¼Œä½†ä½ ä»ç„¶æœ‰å¿…è¦å»äº†è§£Classä¸­çš„ä½¿ç”¨ï¼Œä¸è¯´åˆ«çš„ï¼Œè‡³å°‘é¢è¯•çš„æ—¶å€™é¢è¯•å®˜å¯èƒ½ä¼šé—®ä½ ã€‚*

#### å®¹å™¨ç»„ä»¶ & å±•ç¤ºç»„ä»¶

React-Redux å°†æ‰€æœ‰ç»„ä»¶åˆ†æˆä¸¤å¤§ç±»ï¼šå®¹å™¨ç»„ä»¶ / å±•ç¤ºç»„ä»¶ã€‚

**ğŸ‘‰ å±•ç¤ºç»„ä»¶**

å±•ç¤ºç»„ä»¶æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹å¾ï¼š

1. åªè´Ÿè´£ UI çš„å‘ˆç°ï¼Œä¸å¸¦æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼ˆå³å‰¯ä½œç”¨æ“ä½œï¼‰

2. æ²¡æœ‰çŠ¶æ€ï¼ˆNo Stateï¼‰

3. æ‰€æœ‰æ•°æ®éƒ½ç”± Props æä¾›

4. ä¸ä½¿ç”¨ä»»ä½• Redux çš„ APIs

ä¸‹é¢æ˜¯ä¸€ä¸ªå±•ç¤ºç»„ä»¶çš„ç¤ºä¾‹ï¼š

```react
const Button = props => (
  <button type="button">{props.text}</button>
)
```

> æç¤ºï¼šå› ä¸ºä¸å«æœ‰çŠ¶æ€ï¼Œå±•ç¤ºç»„ä»¶åˆç§°ä¸º"çº¯ç»„ä»¶"ï¼Œå³å®ƒè·Ÿçº¯å‡½æ•°ä¸€æ ·ï¼Œçº¯ç²¹ç”±å‚æ•°å†³å®šå®ƒçš„å€¼ã€‚

**ğŸ‘‰ å®¹å™¨ç»„ä»¶**

å®¹å™¨ç»„ä»¶çš„ç‰¹å¾æ°æ°ç›¸åã€‚

1. è´Ÿè´£ç®¡ç†æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ï¼Œä¸è´Ÿè´£ UI çš„å‘ˆç°

2. å¸¦æœ‰å†…éƒ¨çŠ¶æ€

3. ä½¿ç”¨ Redux  çš„ APIs

> **ç»“è®ºï¼šå±•ç¤ºç»„ä»¶è´Ÿè´£ UI çš„å‘ˆç°ï¼Œå®¹å™¨ç»„ä»¶è´Ÿè´£ç®¡ç†æ•°æ®å’Œé€»è¾‘ã€‚**

React-Redux è§„å®šï¼Œæ‰€æœ‰çš„å±•ç¤ºç»„ä»¶éƒ½ç”±ç”¨æˆ·æä¾›ï¼Œå®¹å™¨ç»„ä»¶åˆ™æ˜¯ç”± React-Redux è‡ªåŠ¨ç”Ÿæˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·è´Ÿè´£è§†è§‰å±‚ï¼ŒçŠ¶æ€ç®¡ç†åˆ™æ˜¯å…¨éƒ¨äº¤ç»™å®ƒã€‚

| #                  | å±•ç¤ºç»„ä»¶                   | å®¹å™¨ç»„ä»¶                           |
| ------------------ | -------------------------- | ---------------------------------- |
| **ä½œç”¨**           | æè¿°å¦‚ä½•å±•ç°ï¼ˆéª¨æ¶ã€æ ·å¼ï¼‰ | æè¿°å¦‚ä½•è¿è¡Œï¼ˆæ•°æ®è·å–ã€çŠ¶æ€æ›´æ–°ï¼‰ |
| **ç›´æ¥ä½¿ç”¨ Redux** | å¦                         | æ˜¯                                 |
| **æ•°æ®æ¥æº**       | props                      | ç›‘å¬ Redux-state                   |
| **æ•°æ®ä¿®æ”¹**       | ä» props è°ƒç”¨å›è°ƒå‡½æ•°      | å‘ Redux æ´¾å‘ actions              |
| **è°ƒç”¨æ–¹å¼**       | æ‰‹åŠ¨                       | é€šå¸¸ç”± React-Redux ç”Ÿæˆ            |

#### connect()

React-Redux å°±æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶HOCï¼Œæä¾› connect æ–¹æ³•ï¼Œç”¨äºç”Ÿæˆå®¹å™¨ç»„ä»¶ã€‚

ä½¿ç”¨äº† connectï¼Œå°±ç›¸å½“äº store.subscribeï¼Œ å³ç»„ä»¶è®¢é˜…äº† store ä¸­çš„æ•°æ®ã€‚

```js
import { connect } from 'react-redux'
const ContainerCounter = connect()(Counter);
```

ä¸Šé¢ä»£ç ä¸­ï¼ŒCounter æ˜¯å±•ç¤ºç»„ä»¶ï¼ŒContainerCounter å°±æ˜¯ç”± React-Redux é€šè¿‡ connect æ–¹æ³•è‡ªåŠ¨ç”Ÿæˆçš„å®¹å™¨ç»„ä»¶ã€‚ä½†æ˜¯ï¼Œå› ä¸ºæ²¡æœ‰å®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œä¸Šé¢è¿™ä¸ªå®¹å™¨ç»„ä»¶æ¯«æ— æ„ä¹‰ï¼Œåªæ˜¯ UI ç»„ä»¶çš„ä¸€ä¸ªå•çº¯çš„åŒ…è£…å±‚ã€‚ä¸ºäº†å®šä¹‰ä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦ç»™å‡ºä¸‹é¢ä¸¤æ–¹é¢çš„ä¿¡æ¯ã€‚

1ï¼‰è¾“å…¥é€»è¾‘ï¼šå¤–éƒ¨çš„æ•°æ®ï¼ˆå³ State å¯¹è±¡ï¼‰å¦‚ä½•è½¬æ¢ä¸ºå±•ç¤ºç»„ä»¶çš„å‚æ•°

2ï¼‰è¾“å‡ºé€»è¾‘ï¼šç”¨æˆ·å‘å‡ºçš„åŠ¨ä½œå¦‚ä½•å˜ä¸º Action å¯¹è±¡ï¼Œä»å±•ç¤ºç»„ä»¶ä¼ å‡ºå»ã€‚

å› æ­¤ï¼Œ`connect` æ–¹æ³•çš„å®Œæ•´ API å¦‚ä¸‹ã€‚

```js
import { connect } from 'react-redux'

const ContainerCounter = connect(
  mapStateToProps,
  mapDispatchToProps
)(Counter)
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`connect` æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š`mapStateToProps` å’Œ `mapDispatchToProps`ã€‚å®ƒä»¬å®šä¹‰äº† å±•ç¤º ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘ã€‚å‰è€…è´Ÿè´£è¾“å…¥é€»è¾‘ï¼Œå³å°†`state`æ˜ å°„åˆ° å±•ç¤º ç»„ä»¶çš„å‚æ•°ï¼ˆ`props`ï¼‰ï¼Œåè€…è´Ÿè´£è¾“å‡ºé€»è¾‘ï¼Œå³å°†ç”¨æˆ·å¯¹ å±•ç¤º ç»„ä»¶çš„æ“ä½œæ˜ å°„æˆ Actionã€‚

#### mapStateToProps()

è¯¥å‡½æ•°å¤„ç†æ•°æ®çš„æµå…¥ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œ ä½¿ç”¨ connect å‡½æ•°ï¼Œä¼ å…¥ mapStateToPropsï¼Œå®Œæˆ store æ•°æ®ä¸ç»„ä»¶çš„ props ç»‘å®šã€‚

```js
const mapStateToProps = (state: RootState) => ({
    count: state.counter.count
});
```

åœ¨å±•ç¤ºç»„ä»¶ä¸­å¯é€šè¿‡ `this.props.count` è®¿é—®ã€‚

#### mapDispatchToProps()

è¯¥å‡½æ•°å¤„ç†æ•°æ®çš„æµå‡ºï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå­—æ®µéƒ½æ˜¯ä¸€ä¸ª dispatch å¤„ç†å‡½æ•°ï¼Œä½¿ç”¨ connect å‡½æ•°ï¼Œä¼ å…¥ mapDispatchToPropsï¼Œå®Œæˆ dispatch ä¸ç»„ä»¶çš„ props ç»‘å®šã€‚

```js
const mapDispatchToProps = (dispatch: AppDispatch) => ({
  increment: () => dispatch(increment()),
  decrement: () => dispatch(decrement()),
});
```

åœ¨å±•ç¤ºç»„ä»¶ä¸­å¯é€šè¿‡ `this.props.increment()` è®¿é—®ï¼Œå…¶å†…éƒ¨é€»è¾‘æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ dispatch ä¸€ä¸ª actionã€‚

#### Provider

React-Redux åˆ©ç”¨ä¸Šä¸‹æ–‡ Contextï¼Œæä¾›çš„æ•°æ®ç»„ä»¶ Providerï¼Œä½¿ç”¨Providerï¼ŒåŠ è½½æ•°æ®ä»“åº“ store å³å¯åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨ storeã€‚

```react
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

// â†’ React-Redux åˆ©ç”¨ä¸Šä¸‹æ–‡ Contextï¼Œæä¾›çš„æ•°æ®ç»„ä»¶ Provider
import { Provider } from 'react-redux';
import store from './stores';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  <React.StrictMode>
    {/* ä½¿ç”¨Providerï¼ŒåŠ è½½æ•°æ®ä»“åº“ store å³å¯åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨ store */}
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>
);
```

> **Tipsï¼š**\<Provider> çš„å®ç°åŸç†æ˜¯åŸºäº **React-Context** å®ç°çš„ã€‚

`React-Redux` è‡ªåŠ¨ç”Ÿæˆçš„å®¹å™¨ç»„ä»¶çš„ä»£ç ï¼Œå°±ç±»ä¼¼ä¸Šé¢è¿™æ ·ï¼Œä»è€Œæ‹¿åˆ°`store`ã€‚

### ä»£ç ç¤ºä¾‹

éœ€æ±‚æè¿°ï¼šè¿™é‡Œæˆ‘ä»¬å°† **Use-in-js** é‡Œé¢çš„ä»£ç é€šè¿‡ React-Class å®ç°ä¸€éã€‚

#### 1. åˆ›å»ºProject

```shell
$ npm create vite@latest use-in-react-class  -- --template react-ts
$ cd use-in-react-class && npm install react-redux redux && code .
```

ç›®å½•ç»“æ„ï¼š

```
.
â”œâ”€â”€ /src  
	  â”œâ”€â”€	/components â†’ è§†å›¾ç»„ä»¶
	      â”œâ”€â”€ Counter.css
	  	  â””â”€â”€	Counter.tsx
	  â”œâ”€â”€	/stores  
	  		â”œâ”€â”€ /middlewares â†’ ä¸­é—´ä»¶
    				â””â”€â”€ index.ts
    		â”œâ”€â”€ /reducers
    				â”œâ”€â”€ counterReducer.ts
    				â”œâ”€â”€ index.ts â†’ åˆå¹¶Reducers
    				â””â”€â”€ statusReducer.ts
	  	  â””â”€â”€	index.ts â†’ åˆ›å»ºStoreå®ä¾‹
	  â”œâ”€â”€	App.tsx
	  â”œâ”€â”€	main.tsx â†’ å¼•å…¥Storeå®ä¾‹
â”œâ”€â”€ ....
```

#### 2. åˆ›å»ºMiddlewares

**`/stores/middlewares/index.ts`**

```typescript
import { Middleware } from 'redux';
export const asyncMiddleware: Middleware = (storeApi) => (next) => (action) => {
  if (typeof action === 'function') {
    // â†’ å¦‚æœä¼ å…¥çš„actionæ˜¯ä¸€ä¸ªå‡½æ•°
    // â†’ è°ƒç”¨è¯¥å‡½æ•°å¹¶ä¼ å…¥ dispatch å’Œ getState ä½œä¸ºå‚æ•°
    return action(storeApi.dispatch, storeApi.getState);
  } else {
    // â†’ å¦åˆ™ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ™®é€š actionï¼Œé‚£å°±ç»§ç»­æ‰§è¡Œ
    return next(action);
  }
};
```

#### 3. åˆ›å»ºReducers

**`counterReducer`**

```typescript
import { ActionCreator } from 'redux';
import { AppDispatch, RootState } from '..';
import { statusToggle } from './statusReducer';

// -- Define Actions
// ğŸ‘‰ ç”¨å¸¸é‡å®šä¹‰Action.typeï¼Œå‡å°‘ä»£ç æ•²é”™
const COUNTER_INCREMENT = 'counter/increment';
const COUNTER_DECREMENT = 'counter/decrement';
const COUNTER_INCREMENT_BY_AMOUNT = 'counter/incrementByAmount';

// ğŸ‘‰ Action ç±»å‹å£°æ˜
type CounterIncrementAction = { type: typeof COUNTER_INCREMENT };
type CounterDecrementAction = { type: typeof COUNTER_DECREMENT };
type CounterIncrementByAmountAction = { type: typeof COUNTER_INCREMENT_BY_AMOUNT; payload: number };
type CounterAction = CounterIncrementAction | CounterDecrementAction | CounterIncrementByAmountAction;

// ğŸ‘‰ å·¥å‚æ¨¡å¼ â†’ åˆ›å»º Action
export const increment: ActionCreator<CounterIncrementAction> = () => ({
  type: COUNTER_INCREMENT,
});
export const decrement: ActionCreator<CounterDecrementAction> = () => ({
  type: COUNTER_DECREMENT,
});
export const incrementByAmount: ActionCreator<CounterIncrementByAmountAction> = (amount: number) => ({
  type: COUNTER_INCREMENT_BY_AMOUNT,
  payload: amount,
});

// ğŸ‘‰ initialState
interface CounterState {
  count: number;
}
const initialState: CounterState = { count: 0 };

// ğŸ‘‰ Define Reducer
const counterReducer = (
  state = initialState,
  action: CounterAction
): CounterState => {
  switch (action.type) {
    case COUNTER_INCREMENT:
      return { ...state, count: state.count + 1 };
    case COUNTER_DECREMENT:
      return { ...state, count: state.count - 1 };
    case COUNTER_INCREMENT_BY_AMOUNT:
      return { ...state, count: state.count + action.payload };
    default:
      return state;
  }
};

// ğŸ‘‰ CHUNKs - å¼‚æ­¥å‡½æ•°
export const incrementAsync = (amount: number) => {
  return async (dispatch: AppDispatch, getState: () => RootState) => {
    const isLoading = getState().status.loading;
    if (isLoading) {
      console.log('å½“å‰æ­£åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œè¯·ç¨åå†è¯•...');
      return;
    }
    dispatch(statusToggle());
    await new Promise((resolve) => {
      console.log('Loading...');
      setTimeout(() => {
        resolve(null);
      }, 1000);
    });
    dispatch(statusToggle());
    dispatch(incrementByAmount(amount));
    console.log('Completed!');
  };
};

export default counterReducer;
```

**`statusReducer.ts`**

```typescript
import { ActionCreator } from 'redux';

// -- Define Actions
// 1. ç”¨å¸¸é‡å®šä¹‰Action.typeï¼Œå‡å°‘ä»£ç æ•²é”™
const STATUS_TOGGLE = 'status/toggle';

// 2. Action ç±»å‹å£°æ˜
type StatusAction = { type: typeof STATUS_TOGGLE };

// 3. å·¥å‚æ¨¡å¼ â†’ åˆ›å»º Action
export const statusToggle: ActionCreator<StatusAction> = () => ({
  type: STATUS_TOGGLE,
});

// -- initialState
interface StatusState {
  loading: boolean;
}
const initialState: StatusState = {
  loading: false,
};

// -- Define Reducer
const statusReducer = (
  state = initialState,
  action: StatusAction
): StatusState => {
  switch (action.type) {
    case STATUS_TOGGLE:
      return { ...state, loading: !state.loading };
    default:
      return state;
  }
};

export default statusReducer;
```

**ğŸ‘‰  åˆå¹¶Reducers**

**`/reducers/index.ts`**

```typescript
import { combineReducers } from 'redux';

import counterReducer from './counterReducer';
import statusReducer from './statusReducer';

export const rootReducer = combineReducers({
  counter: counterReducer,
  status: statusReducer,
});
```

#### 4. åˆ›å»ºStore

**`/store/index.ts`**

```typescript
import { applyMiddleware, createStore } from 'redux';
import { asyncMiddleware } from './middlewares';
import { rootReducer } from './reducers';

const store = createStore(rootReducer, applyMiddleware(asyncMiddleware));

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;

export default store;
```

#### 5. åˆ›å»ºCounter-Comps

**`/components/Counter.tsx`**

```tsx
import React, { ChangeEvent, Dispatch } from 'react';
import { connect } from 'react-redux';
import { RootState } from '../stores';
import {
  decrement,
  increment,
  incrementAsync,
  incrementByAmount,
} from '../stores/reducers/counterReducer';
import './Counter.css';

// â†’ å¤„ç†æ•°æ®çš„æµå…¥ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡
// â†’ ä½¿ç”¨ connect å‡½æ•°ï¼Œä¼ å…¥ mapStateToPropsï¼Œå®Œæˆstoreæ•°æ®ä¸ç»„ä»¶çš„propsç»‘å®š
const mapStateToProps = (state: RootState) => ({
  count: state.counter.count,
  loading: state.status.loading,
});

// â†’ å¤„ç†æ•°æ®çš„æµå‡ºï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„æ¯ä¸€ä¸ªå­—æ®µéƒ½æ˜¯ä¸€ä¸ªdispatchå¤„ç†å‡½æ•°
// â†’ ä½¿ç”¨ connect å‡½æ•°ï¼Œä¼ å…¥ mapDispatchToPropsï¼Œå®Œæˆdispatchä¸ç»„ä»¶çš„propsç»‘å®š
const mapDispatchToProps = (dispatch: Dispatch<any>) => ({
  increment: () => dispatch(increment()),
  decrement: () => dispatch(decrement()),
  incrementByAmount: (amount: number) => dispatch(incrementByAmount(amount)),
  incrementAsync: (amount: number) => dispatch(incrementAsync(amount)),
});

// -- ç±»å‹å£°æ˜
type IProps = ReturnType<typeof mapStateToProps> & ReturnType<typeof mapDispatchToProps>;
type IState = { incrementAmount: string };
class Counter extends React.Component<IProps, IState> {
  // -- constructor
  constructor(props: IProps) {
    super(props);
    this.state = {
      incrementAmount: '5',
    };
  }
  // -- methods
  getAmount = () => Number(this.state.incrementAmount) || 0;
  // -- events
  onIncrement = () => this.props.increment();
  onDecrement = () => this.props.decrement();
  onAddAmount = () => this.props.incrementByAmount(this.getAmount());
  onAddAsync = () => this.props.incrementAsync(this.getAmount());
  onInputChange = ($event: ChangeEvent<HTMLInputElement>) =>
    this.setState({
      incrementAmount: $event.target.value,
    });
  // -- renders
  render(): React.ReactNode {
    return (
      <div className='counter'>
        <div className='row'>
          <button className='button' onClick={this.onIncrement}>+</button>
          <span className='value'>{this.props.count}</span>
          <button className='button' onClick={this.onDecrement}>-</button>
        </div>
        <div className='row'>
          <input
            className='textbox'
            value={this.state.incrementAmount}
            onChange={this.onInputChange}
          />
          <button className='button' onClick={this.onAddAmount}>Add Amount</button>
          <button className='button asyncButton' onClick={this.onAddAsync}>Add Async</button>
        </div>
      </div>
    );
  }
}

// â†’ ç”Ÿæˆå®¹å™¨ç»„ä»¶
export default connect(mapStateToProps, mapDispatchToProps)(Counter);
```

> **TIPsï¼š**Counter æ ·å¼ç›´æ¥å¤åˆ¶ **Use-in-js** é‡Œçš„CSSæ ·å¼å³å¯ã€‚

**`App.tsx`**

```tsx
import React from 'react';
import Counter from './components/Counter';

class App extends React.Component {
  render(): React.ReactNode {
    return (
      <div className='app'>
        <Counter />
      </div>
    );
  }
}

export default App;
```

#### 6. æ³¨å…¥Store

**`main.tsx`**

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

// â†’ React-Redux åˆ©ç”¨ä¸Šä¸‹æ–‡ Contextï¼Œæä¾›çš„æ•°æ®ç»„ä»¶ Provider
import { Provider } from 'react-redux';
import store from './stores';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  <React.StrictMode>
    {/* ä½¿ç”¨Providerï¼ŒåŠ è½½æ•°æ®ä»“åº“ store å³å¯åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨ store */}
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>
);
```

## Use-in-React-Hooks

éœ€æ±‚æè¿°ï¼šè¿™é‡Œæˆ‘ä»¬å°† **Use-in-React-Class** é‡Œé¢çš„ä»£ç é€šè¿‡ React-Hooks å®ç°ä¸€éï¼Œæœ¬ç¤ºä¾‹å¤§éƒ¨åˆ†ä»£ç å¯ä»¥å’Œä¸Šä¸€å°èŠ‚çš„ä»£ç å¤ç”¨ã€‚

Hooksä¸­ï¼ŒReact-Redux æä¾›äº† **`useSelector`** & **`useDispatch`** é’©å­å‡½æ•°è®©åæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿çµæ´»çš„å»è·å–Stateä»¥åŠDispatch.

### 1. åˆ›å»ºProject

```shell
$ npm create vite@latest use-in-react-hooks  -- --template react-ts
$ cd use-in-react-hooks && npm install react-redux redux && code .
```

ç›®å½•ç»“æ„ï¼š

```
.
â”œâ”€â”€ /src  
	  â”œâ”€â”€	/components â†’ è§†å›¾ç»„ä»¶
	      â”œâ”€â”€ Counter.css
	  	  â””â”€â”€	Counter.tsx
	  â”œâ”€â”€	/stores 
    		â”œâ”€â”€ /reducers
    				â”œâ”€â”€ counterReducer.ts
    				â”œâ”€â”€ index.ts â†’ åˆå¹¶Reducers
    				â””â”€â”€ statusReducer.ts
        â”œâ”€â”€ hooks.ts â†’ useSelector & useDispatch
	  	  â””â”€â”€	index.ts â†’ åˆ›å»ºStoreå®ä¾‹
	  â”œâ”€â”€	App.tsx
	  â”œâ”€â”€	main.tsx â†’ å¼•å…¥Storeå®ä¾‹
â”œâ”€â”€ ....
```

> **æç¤ºï¼š**
>
> - åˆ é™¤äº† middlewares ç›®å½•ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ [redux-thunk >>](https://www.npmjs.com/package/redux-thunk) æ¥å¤„ç†ä¸­é—´ä»¶ã€‚
> - æ–°å¢ hooks æ–‡ä»¶ï¼Œå°è£… useSelector & useDispatch æ¥è¯»å–å’Œæ›´æ–°Storeã€‚

### 2. åˆ›å»ºHooks

**`stores/hooks.ts`**

```typescript
import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux';
import type { AppDispatch, RootState } from '.';

// ğŸ‘‰ æ¨èåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œè€Œä¸æ˜¯å•çº¯çš„ä½¿ç”¨ useDispatch & useSelector
export const useAppDispatch = () => useDispatch<AppDispatch>();
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;
```

### 3. åˆ›å»ºReducers

**æç¤ºï¼š** Reducer ç›¸å…³ä»£ç å’Œç¤ºä¾‹ **Use-in-React-Class** ä¸€è‡´ï¼Œä½ å¯ä»¥å‚ç…§ç¤ºä¾‹ç›®å½•å°†å…¶ç›´æ¥å¤åˆ¶/ç²˜è´´è¿‡æ¥ä½¿ç”¨ï¼Œè¿™é‡Œåªåˆ—å‡ºä¿®æ”¹/æ–°å¢éƒ¨åˆ†ä»£ç ã€‚

```typescript
// ....
import { AppThunk } from '..';
export const incrementAsync = (amount: number): AppThunk /** æŒ‡å®šè¿”å›ç±»å‹ */ => {
  return async (dispatch, getState) => {
    const isLoading = getState().status.loading;
    if (isLoading) {
      console.log('å½“å‰æ­£åœ¨æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œè¯·ç¨åå†è¯•...');
      return;
    }
    dispatch(statusToggle());
    await new Promise((resolve) => {
      console.log('Loading...');
      setTimeout(() => {
        resolve(null);
      }, 1000);
    });
    dispatch(statusToggle());
    dispatch(incrementByAmount(amount));
    console.log('Completed!');
  };
};
// ....
```

### 4. åˆ›å»ºStore

> **æç¤ºï¼š** Store ç›¸å…³ä»£ç å’Œç¤ºä¾‹ **Use-in-React-Class** ä¸€è‡´ï¼Œä½ å¯ä»¥å‚ç…§ç¤ºä¾‹ç›®å½•å°†å…¶ç›´æ¥å¤åˆ¶/ç²˜è´´è¿‡æ¥ä½¿ç”¨ï¼Œè¿™é‡Œåªåˆ—å‡ºä¿®æ”¹/æ–°å¢éƒ¨åˆ†ä»£ç ã€‚

**`/store/index.ts`**

```typescript
import { AnyAction, applyMiddleware, createStore } from 'redux';
import { rootReducer } from './reducers';
import thunkMiddleware from 'redux-thunk';
import type { ThunkAction, ThunkMiddleware } from 'redux-thunk';

const store = createStore(
  rootReducer,
  applyMiddleware(thunkMiddleware as ThunkMiddleware) /* æ³¨å†Œä¸­é—´ä»¶*/
);

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
export type AppThunk<ReturnType = void> = ThunkAction<ReturnType, RootState, unknown, AnyAction>;

export default store;
```

### 5. åˆ›å»ºCounter-Comps

> **æç¤ºï¼š** Counter æ ·å¼ä»£ç å’Œç¤ºä¾‹ **Use-in-React-Class** ä¸€è‡´ï¼Œä½ å¯ä»¥ç›´æ¥å¤åˆ¶/ç²˜è´´è¿‡æ¥ä½¿ç”¨ï¼Œè¿™é‡Œåªåˆ—å‡º **`Counter.tsx`** æ–‡ä»¶ä»£ç .

**`/components/Counter.tsx`**

```tsx
import React, { ChangeEvent, memo, useState } from 'react';
import { useAppDispatch, useAppSelector } from '../stores/hooks';
import { decrement, increment, incrementAsync, incrementByAmount } from '../stores/reducers/counterReducer';
import './Counter.css';

const Counter: React.FC = () => {
  // -- state
  const [incrementAmount, setIncrementAmount] = useState('5');
  // -- stores
  const count = useAppSelector((state) => state.counter.count);
  // -- dispatch
  const dispatch = useAppDispatch();
  // -- methods
  const getNumAmount = () => Number(incrementAmount) || 0;
  // -- events
  const onIncrement = () => dispatch(increment());
  const onDecrement = () => dispatch(decrement());
  const onAddAmount = () => dispatch(incrementByAmount(getNumAmount()));
  const onAddAsync = () => dispatch(incrementAsync(getNumAmount()));
  const onInputChange = ($event: ChangeEvent<HTMLInputElement>) => { setIncrementAmount($event.target.value) };
  // -- renders
  return (
    <div className='counter'>
      <div className='row'>
        <button className='button' onClick={onIncrement}>+</button>
        <span className='value'>{count}</span>
        <button className='button' onClick={onDecrement}>-</button>
      </div>
      <div className='row'>
        <input className='textbox' value={incrementAmount} onChange={onInputChange}/>
        <button className='button' onClick={onAddAmount}>Add Amount</button>
        <button className='button asyncButton' onClick={onAddAsync}>Add Async</button>
      </div>
    </div>
  );
};

export default memo(Counter);
```

**`App.tsx`**

```tsx
import React from 'react';
import Counter from './components/Counter';

const App: React.FC = () => (
  <div className='app'>
    <Counter />
  </div>
);

export default App;

```

### 6. æ³¨å…¥Store

> **æç¤ºï¼š** æ³¨å…¥Storeä»£ç å’Œç¤ºä¾‹ **Use-in-React-Class** ä¸€è‡´ï¼Œä½ å¯ä»¥ç›´æ¥å¤åˆ¶/ç²˜è´´è¿‡æ¥ä½¿ç”¨.

# ä¸ƒã€Redux-Toolkitï¼ˆé‡ç‚¹ï¼‰

**ğŸ‘‰  [Redux-Toolkit >>](https://cn.redux-toolkit.js.org/)**

ç°åœ¨ï¼Œè¿æ¥å®¡åˆ¤å§ï¼ï¼ï¼

åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå¦‚ä½ æ‰€è§ï¼ŒRedux æ¶‰åŠç¼–å†™ä¸€äº›å†—é•¿çš„ä»£ç ï¼Œä¾‹å¦‚ä¸å¯å˜æ›´æ–°ã€action types å’Œ action creatorsï¼Œä»¥åŠå½’ä¸€åŒ– stateã€‚è™½ç„¶è¿™äº›æ¨¡å¼æœ‰å……åˆ†çš„å­˜åœ¨ç†ç”±ï¼Œä½†æ˜¯â€œæ‰‹åŠ¨â€ç¼–å†™è¿™äº›ä»£ç å¯èƒ½æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚å¾ˆå¤šæ—¶å€™ç”¨æˆ·ä¸ç¡®å®šç¼–å†™ Redux é€»è¾‘çš„â€œæ­£ç¡®æ–¹æ³•â€æ˜¯ä»€ä¹ˆã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Redux å›¢é˜Ÿåˆ›å»ºäº† Redux Toolkitã€‚

Redux Toolkit åŒ…å«äº†å¯¹äºæ„å»º Redux åº”ç”¨ç¨‹åºè‡³å…³é‡è¦çš„åŒ…å’Œå‡½æ•°ï¼Œç®€åŒ–äº†å¤§å¤šæ•° Redux ä»»åŠ¡ï¼Œé¿å…äº†å¸¸è§é”™è¯¯ï¼Œä½¿å¾—ç¼–å†™ Redux åº”ç”¨ç¨‹åºæ›´å®¹æ˜“äº†ã€‚å› æ­¤ï¼Œ**Redux Toolkit æ˜¯ç¼–å†™ Redux åº”ç”¨ç¨‹åºé€»è¾‘çš„æ ‡å‡†æ–¹å¼**ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œ**ä½ åº”è¯¥ä½¿ç”¨ Redux Toolkit æ¥ç¼–å†™ Redux é€»è¾‘ã€‚**

å½“ä½ ä½¿ç”¨ Redux Toolkit æ—¶ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ä»‹ç»çš„æ‰€æœ‰æ¦‚å¿µï¼ˆactionsã€reducersã€store setupã€action creatorsã€thunk ç­‰ï¼‰ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯ **Redux Toolkit æä¾›äº†æ›´ç®€å•çš„æ–¹æ³•æ¥ç¼–å†™ä»£ç **ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ Redux-Toolkit å°†ä¹‹å‰çš„ Counter æ¡ˆä¾‹å†å®ç°ä¸€éã€‚

## Examplesï¼šCounters



![](./IMGs/redux_counter.gif)

### 1. åˆ›å»ºProject

```shell
$ npm create vite@latest use-in-toolkit  -- --template react-ts 
$ cd use-in-toolkit && npm install @reduxjs/toolkit react-redux && code .
```

é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
.
â”œâ”€â”€ /src  
	  â”œâ”€â”€	/components â†’ è‡ªå®šä¹‰ç»„ä»¶
	      â”œâ”€â”€ /counter
            â”œâ”€â”€ Counter.css
            â””â”€â”€	Counter.tsx
        â””â”€â”€ /user
        	  â””â”€â”€	User.tsx
	  â”œâ”€â”€	/store      â†’ Redux Store
    		â”œâ”€â”€ /slices â†’ åŠŸèƒ½ï¼Œreducers & actions & chunks...
    				â”œâ”€â”€ counterSlice.ts
        		â””â”€â”€	userSlice.ts
    		â”œâ”€â”€ hooks.ts â†’ é’©å­
    		â””â”€â”€ index.ts â†’ ç»„åˆReducers/åˆ›å»ºStoreå®ä¾‹
	  â”œâ”€â”€	App.tsx
	  â”œâ”€â”€	index.less
	  â”œâ”€â”€	main.tsx â†’ Provider-Store
â”œâ”€â”€ ....
```

æ¥ä¸‹æ¥æˆ‘ä»¬é…ç½®ä¸€ä¸‹å–åˆ«åï¼Œæ¯•ç«Ÿå¼•ç”¨è·¯å¾„ä¸­å‡ºç°æ³¨å…¥ **`./..`** çš„ç¬¦å·æˆ‘è§‰å¾—ç‰¹åˆ«æ‰­ã€‚

**ğŸ‘‰ `vite.config.ts`**

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
});
```

**ğŸ‘‰ `tsconfig.json`**

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
```

### 2. åˆ›å»ºRedux Store

**ğŸ‘‰ `@/store/index.ts`**

```typescript
import { AnyAction, configureStore, ThunkAction } from '@reduxjs/toolkit';
import couterReducer from '@/stores/slices/couterSlice';
import userReducer from '@/stores/slices/userSlice';

// ğŸ‘‰ è‡ªåŠ¨è°ƒç”¨ combineReducers åˆå¹¶ reducers
const store = configureStore({
  reducer: {
    counter: couterReducer,
    user: userReducer,
  },
});

// ğŸ‘‰ TypeScriptï¼šä» store æœ¬èº«æ¨æ–­å‡º RootState å’Œ AppDispatch ç±»å‹
export type AppDispatch = typeof store.dispatch;
export type RootState = ReturnType<typeof store.getState>;

// ğŸ‘‰ å®šä¹‰Chunkç±»å‹
export type AppThunk<ReturnType = void> = ThunkAction<ReturnType, RootState, unknown, AnyAction>;

export default store;

```

> æç¤ºï¼šconfigureStore æ–¹æ³•ä¸ºæˆ‘ä»¬è‡ªåŠ¨è°ƒç”¨å¹¶ç»„åˆï¼ˆcombineReducersï¼‰ Reducersã€‚

### 3. åˆ›å»ºRedux Slice

**ğŸ‘‰ `@/store/slices/counterSlice.ts`**

```typescript
import { createSlice, PayloadAction } from '@reduxjs/toolkit';
import { AppThunk, RootState } from '@/stores';

type CounterState = { count: number };

// ğŸ‘‰ initialState
const initialState: CounterState = { count: 0 };

// ğŸ‘‰ Chunks
// â†’ å¼‚æ­¥æ›´æ–°Storeï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ createAsyncThunk å‡½æ•°åˆ›å»º
export const incrementAsync = (amount: number): AppThunk => {
  return async (dispatch, getState) => {
    await new Promise((resolve) => {
      console.log('Loading...');
      setTimeout(() => {
        resolve(null);
      }, 1000);
    });
    dispatch(incrementByAmount(amount));
    console.log('Completed!');
  };
};

// ğŸ‘‰ Define Slice
const counterSlice = createSlice({
  name: 'counter',
  initialState,
  reducers: {
    // -- è‡ªåŠ¨ç”ŸæˆActionï¼š{ type: 'counter/increment' }
    increment: (state) => {
      // â†’ Redux Toolkit å…è®¸æˆ‘ä»¬åœ¨ reducers å†™ "å¯å˜" é€»è¾‘ã€‚
      // â†’ å¹¶ä¸æ˜¯çœŸæ­£çš„æ”¹å˜ state å› ä¸ºå®ƒä½¿ç”¨äº† immer åº“
      // â†’ å½“ immer æ£€æµ‹åˆ° ã€Œdraft stateã€ æ”¹å˜æ—¶ï¼Œä¼šåŸºäºè¿™äº›æ”¹å˜å»åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜çš„ state
      state.count += 1;
    },
    // -- è‡ªåŠ¨ç”ŸæˆActionï¼š{ type: 'counter/decrement' }
    decrement: (state) => {
      state.count -= 1;
    },
    // -- è‡ªåŠ¨ç”ŸæˆActionï¼š{ type: 'counter/incrementByAmount', payload: number }
    incrementByAmount: (state, action: PayloadAction<number>) => {
      state.count += action.payload;
    },
  },
});

// ğŸ‘‰ Selectors
export const selectCount = (state: RootState) => state.counter.count;

// ğŸ‘‰ Export Dispatchs
export const { increment, decrement, incrementByAmount } = counterSlice.actions;

// ğŸ‘‰ Export Reducer
export default counterSlice.reducer;
```

**ğŸ‘‰ `@/store/slices/userSlice`**

```typescript
import { createAsyncThunk, createSlice, PayloadAction } from '@reduxjs/toolkit';
import { AppDispatch, RootState } from '@/stores';

// ğŸ‘‰ Define some types.
type UserInfos = { name: string; job: string };
type UserState = { loading: boolean; infos: UserInfos };

// ğŸ‘‰ initialState
const initialState: UserState = {
  infos: { name: '', job: '' },
  loading: false,
};

// ğŸ‘‰ Chunks - å¼‚æ­¥é€»è¾‘
// â†’ æ ¹æ®IDè¯·æ±‚ç”¨æˆ·ä¿¡æ¯
export const fetchUserById = createAsyncThunk<
  // â†’ å®šä¹‰è¿”å›å€¼ç±»å‹
  UserInfos,
  // â†’ å®šä¹‰å‚æ•°ç±»å‹
  string,
  // â†’ å®šä¹‰ Thunk-Apis ç±»å‹ï¼Œæ¯”å¦‚ dispatch & getState è¿”å›å€¼ç±»å‹
  { dispatch: AppDispatch; state: RootState }
>('user/fetchUserById', async (userId, thunkApi) => {
  const { dispatch, getState, requestId, signal, extra } = thunkApi;
  console.log(getState());
  console.log(`USER ID is: ${userId}`);
  // â†’ æ¨¡æ‹Ÿè¯·æ±‚
  const response = await new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve({ name: 'å¼ ä¸‰', job: 'ç¨‹åºçŒ¿' });
    }, 1000);
  });
  // â†’ æ¨æ–­è¿”å›å€¼ç±»å‹
  return response as UserInfos;
});

// ğŸ‘‰ Define Slice
const userSlice = createSlice({
  name: 'user',
  initialState,
  reducers: {
    // -- è‡ªåŠ¨ç”ŸæˆActionï¼š{ type: 'user/updateInfos', payload: UserInfos }
    updateInfos: (state, action: PayloadAction<UserInfos>) => {
      state.infos = action.payload;
    },
  },
  // â†’ å¤„ç†å¼‚æ­¥ thunk dispatch çš„æ¯ä¸ª action
  extraReducers(builder) {
    builder
      .addCase(fetchUserById.pending, (state) => {
        state.loading = true;
      })
      .addCase(fetchUserById.fulfilled, (state, action) => {
        state.loading = false;
        state.infos = action.payload;
      })
      .addCase(fetchUserById.rejected, (state, action) => {
        state.loading = false;
        console.log(action.error.message);
      });
  },
});

// ğŸ‘‰ Selectors
export const selectInfos = (state: RootState) => state.user.infos;
export const selectLoading = (state: RootState) => state.user.loading;

// ğŸ‘‰ Export Dispatchs
export const { updateInfos } = userSlice.actions;

// ğŸ‘‰ Export Reducer
export default userSlice.reducer;
```

### 4. åˆ›å»ºRedux Hooks

**ğŸ‘‰ `@/store/hooks.ts`**

```typescript
import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux';
import { AppDispatch, RootState } from '@/stores';

// ğŸ‘‰ æ¨èåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œè€Œä¸æ˜¯å•çº¯çš„ä½¿ç”¨ useDispatch & useSelector
export const useAppDispatch = () => useDispatch<AppDispatch>();
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;
```

### 5. åˆ›å»ºReact Counters-Comp

> **æç¤ºï¼š** **`Counter.css`** ç›´æ¥å¤åˆ¶ **Use-in-js** é‡Œçš„æ ·å¼ä»£ç å³å¯ã€‚

**ğŸ‘‰ `@/components/conter/Counter.tsx`**

```tsx
import React, { ChangeEvent, memo, useState } from 'react';
import { useAppDispatch, useAppSelector } from '@/stores/hooks';
import { decrement, increment, incrementAsync, incrementByAmount, selectCount } from '@/stores/slices/couterSlice';
import './Counter.css';

const Counter: React.FC = () => {
  // -- state
  const [incrementAmount, setIncrementAmount] = useState('5');
  // -- stores
  const count = useAppSelector(selectCount);
  // -- dispatch
  const dispatch = useAppDispatch();
  // -- methods
  const getNumAmount = () => Number(incrementAmount) || 0;
  // -- events
  const onIncrement = () => dispatch(increment());
  const onDecrement = () => dispatch(decrement());
  const onAddAmount = () => dispatch(incrementByAmount(getNumAmount()));
  const onAddAsync = () => dispatch(incrementAsync(getNumAmount()));
  const onInputChange = ($event: ChangeEvent<HTMLInputElement>) => setIncrementAmount($event.target.value);
  // -- renders
  return (
    <div className='counter'>
      <div className='row'>
        <button className='button' onClick={onIncrement}>+</button>
        <span className='value'>{count}</span>
        <button className='button' onClick={onDecrement}>-</button>
      </div>
      <div className='row'>
        <input
          className='textbox'
          value={incrementAmount}
          onChange={onInputChange}
        />
        <button className='button' onClick={onAddAmount}>Add Amount</button>
        <button className='button asyncButton' onClick={onAddAsync}>Add Async</button>
      </div>
    </div>
  );
};

export default memo(Counter);
```

**ğŸ‘‰ `@/components/user/User.tsx`**

```tsx
import { nanoid } from '@reduxjs/toolkit';
import React, { CSSProperties, memo } from 'react';
import { useAppDispatch, useAppSelector } from '@/stores/hooks';
import {
  fetchUserById,
  selectInfos,
  selectLoading,
} from '@/stores/slices/userSlice';

const User: React.FC = () => {
  // -- styles
  const styles: CSSProperties = {
    textAlign: 'center',
  };
  // -- stores
  const infos = useAppSelector(selectInfos);
  const loading = useAppSelector(selectLoading);
  // -- dispatch
  const dispatch = useAppDispatch();
  // -- renders
  return (
    <div style={styles}>
      <p>{loading ? 'Loading...' : `${infos.name} - ${infos.job}`}</p>
      {/* è¿™é‡Œ â€œfetchUserByIdâ€ çš„å‚æ•°è¢«è‡ªåŠ¨æ¨æ–­ä¸º string */}
      {/* ç”Ÿæˆéšæœºçš„IDå­—ç¬¦ä¸²ï¼šnanoid()  */}
      <button onClick={() => dispatch(fetchUserById(nanoid()))}>
        Fetch Infos
      </button>
    </div>
  );
};

export default memo(User);
```

**ğŸ‘‰ App.tsx**

```tsx
import React from 'react';
import Counter from '@/components/counter/Counter';
import User from '@/components/user/User';

const App: React.FC = () => (
  <div className='app'>
    <Counter />
    <User />
  </div>
);

export default App;
```

### 6. æ³¨å…¥Store

**ğŸ‘‰ main.tsx**

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

// â†’ React-Redux åˆ©ç”¨ä¸Šä¸‹æ–‡ Contextï¼Œæä¾›çš„æ•°æ®ç»„ä»¶ Provider
import { Provider } from 'react-redux';
import store from './stores';

ReactDOM.createRoot(document.getElementById('root') as HTMLElement).render(
  <React.StrictMode>
    {/* ä½¿ç”¨Providerï¼ŒåŠ è½½æ•°æ®ä»“åº“ store å³å¯åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨ store */}
    <Provider store={store}>
      <App />
    </Provider>
  </React.StrictMode>
);
```

è‡³æ­¤ï¼Œç¤ºä¾‹ä»£ç å·²ç¼–è¾‘å®Œæˆï¼Œè¿è¡Œä»£ç æŸ¥çœ‹æ•ˆæœå§ã€‚

## Examplesï¼šTodos

Nodeï¼šv18.17.1

pnpmï¼šv8.7.5

**ğŸ‘‰ Todos Intro.**

æ¥ä¸‹æ¥æˆ‘ä»¬ä»¥ä¸€ä¸ªå°å‹çš„  â€œå¾…åŠäº‹é¡¹â€ åº”ç”¨ç¨‹åºå¼€å§‹ã€‚é¦–å…ˆå¼„æ¸…æ¥šè¿™ä¸ªåº”ç”¨ç¨‹åºçš„åˆå§‹ä¸šåŠ¡éœ€æ±‚ï¼š

- UI åº”åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š
  - ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè®©ç”¨æˆ·è¾“å…¥æ–°å¾…åŠäº‹é¡¹çš„æ–‡æœ¬
  - æ‰€æœ‰ç°æœ‰å¾…åŠäº‹é¡¹çš„åˆ—è¡¨
  - é¡µè„šéƒ¨åˆ†ï¼Œæ˜¾ç¤ºæœªå®Œæˆçš„å¾…åŠäº‹é¡¹æ•°é‡ï¼Œå¹¶æ˜¾ç¤ºè¿‡æ»¤é€‰é¡¹
- å¾…åŠäº‹é¡¹åˆ—è¡¨é¡¹åº”è¯¥æœ‰ä¸€ä¸ªå¤é€‰æ¡†æ¥åˆ‡æ¢â€œå®Œæˆâ€çŠ¶æ€ã€‚è¿˜åº”è¯¥èƒ½å¤Ÿä¸ºé¢„å®šä¹‰çš„é¢œè‰²åˆ—è¡¨æ·»åŠ é¢œè‰²ç¼–ç çš„ç±»åˆ«æ ‡ç­¾ï¼Œå¹¶åˆ é™¤å¾…åŠäº‹é¡¹ã€‚
- è®¡æ•°å™¨åº”è¯¥å¤æ•°æ´»åŠ¨å¾…åŠäº‹é¡¹çš„æ•°é‡ï¼šâ€œ0 itemsâ€ã€â€œ1 itemsâ€ã€â€œ3 itemsâ€ç­‰
- åº”è¯¥æœ‰æŒ‰é’®å°†æ‰€æœ‰å¾…åŠäº‹é¡¹æ ‡è®°ä¸ºå·²å®Œæˆï¼Œå¹¶é€šè¿‡åˆ é™¤å®ƒä»¬æ¥æ¸…é™¤æ‰€æœ‰å·²å®Œæˆçš„å¾…åŠäº‹é¡¹
- åº”è¯¥æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è¿‡æ»¤åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„å¾…åŠäº‹é¡¹ï¼š
  - å¾…åŠäº‹é¡¹å¯åŸºäº All ã€ Active å’Œ Completed è¿›è¡Œè¿‡æ»¤
  - åŸºäºé€‰æ‹©ä¸€ç§æˆ–å¤šç§é¢œè‰²è¿›è¡Œè¿‡æ»¤ï¼Œå¹¶æ˜¾ç¤ºæ ‡ç­¾ä¸è¿™äº›é¢œè‰²åŒ¹é…çš„ä»»ä½•å¾…åŠäº‹é¡¹

ç¨åå°†æ·»åŠ æ›´å¤šéœ€æ±‚ã€‚

### 1. åˆ›å»º & é…ç½®

#### åˆ›å»ºé¡¹ç›®

é¦–å…ˆæˆ‘ä»¬é€šè¿‡ vite åˆ›å»ºä¸€ä¸ª react-ts é¡¹ç›®

```shell
$ pnpm create vite todolist --template react-ts
$ cd todolist && pnpm install && code .
```

#### é…ç½®åˆ«å

å¼•ç”¨æ¨¡å—æ—¶ï¼Œä½¿ç”¨ @ å¼•ç”¨ï¼Œé¿å… `../..` å½±å“å¯è¯»æ€§ï¼Œè¿™é‡Œéœ€è¦é…ç½®ä¸€ä¸‹åˆ«åã€‚

â‘  å®‰è£…ç›¸å…³ä¾èµ–

```shell
$ pnpm i @types/node -D
```
â‘¡ æ›´æ–° `vite.config.ts`

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { resolve } from 'path';
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
});
```

â‘¢ åœ¨ `tsconfig.json` æ–‡ä»¶ä¸­æ–°å¢å¦‚ä¸‹é…ç½®ï¼š

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
```

#### ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ /src  
	  â”œâ”€â”€	/components â†’ è‡ªå®šä¹‰ç»„ä»¶
	      â”œâ”€â”€ /footer
	  	  		â””â”€â”€	Footer.tsx
        â”œâ”€â”€ /header
        		â””â”€â”€	Header.tsx
        â””â”€â”€	/todos
        		â”œâ”€â”€ TodoList.tsx
        		â””â”€â”€	TodoListItem.tsx
	  â”œâ”€â”€	/constants  â†’ å¸¸é‡/è®°å½•æ»¤è‰²å™¨é¢œè‰²é›†åˆ
    		â””â”€â”€	index.ts
	  â”œâ”€â”€	/service    â†’ å¼‚æ­¥è¯·æ±‚
    		â””â”€â”€	index.ts
	  â”œâ”€â”€	/store      â†’ Redux Store
    		â”œâ”€â”€ /slices â†’ åŠŸèƒ½ï¼Œreducers & actions & chunks...
        		â”œâ”€â”€ filtersSlice.ts
        		â””â”€â”€	todosSlice.ts
    		â”œâ”€â”€ hooks.ts â†’ é’©å­
    		â””â”€â”€ index.ts â†’ ç»„åˆReducers/åˆ›å»ºStoreå®ä¾‹
	  â”œâ”€â”€	App.tsx
	  â”œâ”€â”€	index.less
	  â”œâ”€â”€	main.tsx â†’ Provider-Store
â”œâ”€â”€ ....
```

### 2. å®‰è£…ä¾èµ–

```shell
$ pnpm i @reduxjs/toolkit react-redux redux-logger 
```

```shell
$ pnpm i less @types/redux-logger -D
```

> **æç¤º**ï¼šç¤ºä¾‹ä½¿ç”¨ less æ„å»ºæ ·å¼ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å®‰è£… lessã€‚

### 3. åˆ›å»º Redux Slice














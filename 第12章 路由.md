# 一、前言

[React Router](https://reactrouter.com/) 是一个基于 [React](https://zh-hans.reactjs.org/) 之上的强大路由库，它可以让你向应用中快速地添加视图和数据流，同时保持页面与 URL 间的同步。react-router 包介绍：

- `react-router`：核心库
- `react-router-dom`： 用于 DOM 绑定的路由（网页）*
- `react-router-native`： 用于 React Native 绑定的路由（原生App）

React Router 中有三类组件:

- 路由器：BrowserRouter，HashRouter
- 路由匹配器：Route，Switch
- 导航：Link，NavLink，Redirect

# 二、API

## 1. \< Router >

Router 是所有路由组件共用的底层接口，一般我们的应用并不会使用这个接口，而是使用高级的路由：

- [< BrowserRouter >](https://reactrouter.com/docs/en/v6/api#browserrouter)：`/` 斜杠形式显示路由路径 => *`http://localhost:3000/search`*
- [< HashRouter >](https://reactrouter.com/docs/en/v6/api#hashrouter)：`#` 哈希形式显示路由路径 => *`http://localhost:3000/#/search`*

> **Tips：**这里只列举网页中所用到的路由模式。

## 2. < Routes > and < Route >

[< Routes > and < Route >](https://reactrouter.com/docs/en/v6/api#routes-and-route) 是 React Router 中基于当前位置渲染的主要方法。

你可以把 < Route > 看作是 `if` 语句; 如果它的路径与当前URL匹配，它将呈现它的元素！< Route caseSensitive > 属性决定是否应该以区分大小写的方式进行匹配（默认为 `false`）。  

常用属性：

```typescript
export interface RouteProps {
    caseSensitive?: boolean;
    children?: React.ReactNode;
    element?: React.ReactNode | null;
    index?: boolean;
    path?: string; // 匹配路由
}
```

> **Tips：** 这里的 Routes 类似于 在 V6 版本之前使用的 Switch，重命名了。

## 3. \< Link >

[< Link >](https://reactrouter.com/docs/en/v6/api#link) 声明式导航，是一个元素，最终渲染成 \< a >，组件属性如下：

常用属性：

```typescript
export interface LinkProps {
    reloadDocument?: boolean;
    replace?: boolean;
    state?: any;
    to: To;
}
```

> **Tips：**对 < Link to > 值是相对于父路由解析的。

## 4. \< NavLink >

[< NavLink >](https://reactrouter.com/docs/en/v6/api#navlink) 是 \< Link > 的一个特殊版本，当呈现的元素与当前URL匹配时，它将向其添加样式属性。

```jsx
<NavLink
  to='/'
  style={({ isActive }) => (isActive ? activeStyle : undefined)}
>
  Home
</NavLink>
```

## 5. < Navigate>

[< Navigate >](https://reactrouter.com/docs/en/v6/api#navigate) 编程式路由跳转的声明式版本，API一致，通过它可以让我们以标签的形式实现路由的操作，比如跳转、重定向等。

```react
isLogin ? (<Home />) : (<Navigate to="/login" />)
```

> **Tips：** 类似于 v6 版本你之前的 [< Redirect >](https://reacttraining.com/react-router/web/api/Redirect) ，但比其更强大。

## 6. < Outlet >

[< Outlet >](https://reactrouter.com/docs/en/v6/api#outlet) 应该在父路由元素中使用来渲染子路由元素。 这允许在渲染子路由时显示嵌套UI。 如果父路由完全匹配，它会渲染一个子索引路由，如果没有索引路由则什么都不渲染。

如果你熟悉 Vue，可以将其理解为 Vue 中的 `< router-view />`

## 7. useNavigate

[useNavigate](https://reactrouter.com/docs/en/v6/api#usenavigate) 钩子返回一个函数，使得我们可以实现编程式导航，类型定义如下：

```typescript
declare function useNavigate(): NavigateFunction;

interface NavigateFunction {
  (
    to: To,
    options?: { replace?: boolean; state?: any }
  ): void;
  (delta: number): void;
}
```

参数解读：

- `to`：跳转路由
- `options`：
  - `state`：传递参数（不会在url中呈现）
  - `replace`：是否替换
- `delta`：回退，类似于 `history.go(delta)`，实现回退功能

# 三、安装/引用

**\> 安装**

```shell
$ npx create-react-app hello-react-router
$ cd hello-react-router
$ npm install react-router-dom@6
```

**\> 引入**

```jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import App from './App';

const root = ReactDOM.createRoot(document.getElementById('root'));

root.render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);
```

# 四、核心功能 *

## 1. 路由配置

路由配置是一组指令，用来告诉 router 如何匹配 URL以及匹配后如何执行代码。

### [routes-and-route](https://reactrouter.com/docs/en/v6/api#routes-and-route)

```react
import { Routes, Route, Link, Outlet } from 'react-router-dom';

export default function App() {
  return (
    <div>
      <h1>Welcome to React Router!</h1>
      {/* 生成路由 */}
      <Routes>
        <Route path='/' element={<Layout />}>
          <Route index element={<Home />} />
          <Route path='about' element={<About />} index />
          <Route path='news' element={<News />} />
          <Route path="*" element={<NoMatch />} />
        </Route>
      </Routes>
    </div>
  );
}

// -- 页面组件
const Home = () => <div>This is the Home page.</div>;
const About = () => <div>This is the About page.</div>;
const News = () => <div>This is the News page.</div>;
const NoMatch = () => <div>404 Not Found</div>

// -- 布局
const Layout = () => (
  <>
    {/* 导航 */}
    <nav>
      <ul>
        <li><Link to='/'>Home</Link></li>
        <li><Link to='/about'>About</Link></li>
        <li><Link to='/news'>News</Link></li>
      </ul>
    </nav>
    {/* 路由视图，类似于vue中的 router-view */}
    <Outlet />
  </>
);
```

### [useRoutes](https://reactrouter.com/docs/en/v6/api#useroutes)

```tsx
import type { RouteObject } from 'react-router-dom';
import { Link, Outlet, useRoutes } from 'react-router-dom';

export default function App() {
  // -- 定义路由
  const routes: RouteObject[] = [
    {
      path: '/',
      element: <Layout />,
      children: [
        { index: true, element: <Home /> },
        { path: '/about', element: <About /> },
        { path: '/news', element: <News /> },
        { path: '/*', element: <NoMatch /> },
      ],
    },
  ];
  // -- 生成路由元素
  const element = useRoutes(routes);

  return (
    <div>
      <h1>Welcome to React Router!</h1>
      {/* 生成路由 */}
      {element}
    </div>
  );
}

// -- 页面组件
const Home = () => <div>This is the Home page.</div>;
const About = () => <div>This is the About page.</div>;
const News = () => <div>This is the News page.</div>;
const NoMatch = () => <div>404 Not Found</div>;

// -- 布局
const Layout = () => (
  <>
    {/* 导航 */}
    <nav>
      <ul>
        <li><Link to='/'>Home</Link></li>
        <li><Link to='/about'>About</Link></li>
        <li><Link to='/news'>News</Link></li>
      </ul>
    </nav>
    {/* 路由视图，类似于vue中的 router-view */}
    <Outlet />
  </>
);
```

## 2. 路由嵌套

```react
import { Link, Outlet, useRoutes } from 'react-router-dom';

export default function App() {
  // -- 定义路由
  const routes = [
    {
      path: '/',
      element: <Layout />,
      children: [
        { index: true, element: <Java /> },
        {
          path: '/web',
          element: <Web />,
          children: [
            { index: true, element: <HTML /> },
            { path: '/web/css', element: <CSS /> },
            { path: '/web/js', element: <JavaScript /> },
          ],
        },
        { path: '/*', element: <NoMatch /> },
      ],
    },
  ];
  // -- 生成路由元素
  const element = useRoutes(routes);

  return (
    <div>
      <h1>Welcome to React Router!</h1>
      {/* 生成路由 */}
      {element}
    </div>
  );
}

// -- 页面组件
const Java = () => <div>This is the Java page.</div>;
const Web = () => (
  <div>
    <div>Please choose a web course:</div>
    {/* 子路由导航 */}
    <nav>
      <ul>
        <li><Link to=''>HTML</Link></li>
        <li><Link to='css'>CSS</Link></li>
        <li><Link to='js'>JavaScript</Link></li>
      </ul>
    </nav>
    {/* 渲染子路由 */}
    <Outlet />
  </div>
);
const HTML = () => <div>This is the HTML page.</div>;
const CSS = () => <div>This is the CSS page.</div>;
const JavaScript = () => <div>This is the JavaScript page.</div>;
const NoMatch = () => <div>404 Not Found</div>;

// -- 布局
const Layout = () => (
  <>
    {/* 导航 */}
    <nav>
      <ul>
        <li><Link to='/'>Java</Link></li>
        <li><Link to='/web'>Web</Link></li>
      </ul>
    </nav>
    {/* 路由视图，类似于vue中的 router-view */}
    <Outlet />
  </>
);
```

## 3. 路由传参

### [useParams](https://reactrouter.com/docs/en/v6/api#useparams)

1）设置参数

```jsx
<Route path='/details/:id' element={<Details />} />
```

> **Tips：**在参数后面加上 `?` 表示可选参数。如：*`/details/:id/:type?`* 其中 `type` 为可选参数

2）传递参数

```jsx
// -- 编程式
navigate('/details/123');
// -- 声明式
<Link to='/details/123'>Details</Link>
```

3）读取参数

```jsx
const { id } = useParams();
```

### [useSearchParams](https://reactrouter.com/docs/en/v6/api#usesearchparams)

1）传递参数

```jsx
// -- 编程式
navigate('/details?id=123');
// -- 声明式
<Link to='/details?id=123'>Details</Link>
```

2）读取参数

```react
const [searchParams] = useSearchParams();
const id = searchParams.get('id');
```

### State

 同query差不多，只是属性不一样，而且state传的参数是加密的，query传的参数是公开的。

1）传递参数

```jsx
navigate('/details', {
  state: { name: 'Li-HONGYAO', job: '前端工程师' },
});
```

2）读取参数

```jsx
const { state } = useLocation();
```

### 4. 路由懒加载

```jsx
const Details = React.lazy(() => import('@/pages/Details'));
```






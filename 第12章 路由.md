# ä¸€ã€å‰è¨€

[React Router](https://reactrouter.com/) æ˜¯ä¸€ä¸ªåŸºäº React ä¹‹ä¸Šçš„å¼ºå¤§è·¯ç”±åº“ï¼Œå®ƒå¯ä»¥è®©ä½ å‘åº”ç”¨ä¸­å¿«é€Ÿåœ°æ·»åŠ è§†å›¾å’Œæ•°æ®æµï¼ŒåŒæ—¶ä¿æŒé¡µé¢ä¸ URL é—´çš„åŒæ­¥ã€‚

# äºŒã€API

## 1. \< Router >

Router æ˜¯æ‰€æœ‰è·¯ç”±ç»„ä»¶å…±ç”¨çš„åº•å±‚æ¥å£ï¼Œä¸€èˆ¬æˆ‘ä»¬çš„åº”ç”¨å¹¶ä¸ä¼šä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œè€Œæ˜¯ä½¿ç”¨é«˜çº§çš„è·¯ç”±ï¼š

- [< BrowserRouter >](https://reactrouter.com/en/main/router-components/browser-router)ï¼š`/` æ–œæ å½¢å¼æ˜¾ç¤ºè·¯ç”±è·¯å¾„ â†’ *`http://localhost:3000/search`Â·Webç«¯é¦–é€‰*
- [< HashRouter >](https://reactrouter.com/en/main/router-components/hash-router)ï¼š`#` å“ˆå¸Œå½¢å¼æ˜¾ç¤ºè·¯ç”±è·¯å¾„ => *`http://localhost:3000/#/search`Â·ä¸åˆ©äºSEO* 

> **Tipsï¼š**è¿™é‡Œåªåˆ—ä¸¾ç½‘é¡µä¸­æ‰€ç”¨åˆ°çš„è·¯ç”±æ¨¡å¼ã€‚

å¯¹åº”çš„é’©å­å‡½æ•°ï¼š

- [createBrowserRouter](https://reactrouter.com/en/main/routers/create-browser-router)
- [createHashRouter](https://reactrouter.com/en/main/routers/create-hash-router)

è¿™é‡Œä¸»è¦ä»‹ç» `createBrowserRouter`ï¼Œè¿™æ˜¯æ‰€æœ‰ Web é¡¹ç›®çš„æ¨èè·¯ç”±ï¼Œå®ƒä½¿ç”¨ DOM History API æ¥æ›´æ–°URLå¹¶ç®¡ç†å†å²è®°å½•å †æ ˆã€‚

## 2. < Route >

[< Route >](https://reactrouter.com/en/main/route/route) æ˜¯ React-Router ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼ŒåŸºäºå½“å‰ä½ç½®æ¸²æŸ“çš„ä¸»è¦æ–¹æ³•ã€‚ä½ å¯ä»¥æŠŠ < Route > çœ‹ä½œæ˜¯ `if` è¯­å¥ï¼Œ å¦‚æœå®ƒçš„è·¯å¾„ä¸å½“å‰URLåŒ¹é…ï¼Œå®ƒå°†å‘ˆç°å®ƒçš„å…ƒç´ ï¼

å¸¸ç”¨å±æ€§ï¼š

```typescript
interface RouteObject {
  path?: string;
  index?: boolean;
  children?: React.ReactNode;
  caseSensitive?: boolean;
  id?: string;
  loader?: LoaderFunction;
  action?: ActionFunction;
  element?: React.ReactNode | null;
  errorElement?: React.ReactNode | null;
  handle?: RouteObject["handle"];
  shouldRevalidate?: ShouldRevalidateFunction;
}
```

## 3. \< Link >

[< Link >](https://reactrouter.com/en/main/components/link) å£°æ˜å¼å¯¼èˆªï¼Œæ˜¯ä¸€ä¸ªå…ƒç´ ï¼Œæœ€ç»ˆæ¸²æŸ“æˆ \< a >ï¼Œç»„ä»¶å±æ€§å¦‚ä¸‹ï¼š

å¸¸ç”¨å±æ€§ï¼š

```typescript
export interface LinkProps {
    reloadDocument?: boolean;
    replace?: boolean;
    state?: any;
    to: To;
}
```

> **Tipsï¼š**å¯¹ < Link to > å€¼æ˜¯ç›¸å¯¹äºçˆ¶è·¯ç”±è§£æçš„ã€‚

## 4. \< NavLink >

[< NavLink >](https://reactrouter.com/en/main/components/nav-link) æ˜¯ \< Link > çš„ä¸€ä¸ªç‰¹æ®Šç‰ˆæœ¬ï¼Œå½“å‘ˆç°çš„å…ƒç´ ä¸å½“å‰URLåŒ¹é…æ—¶ï¼Œå®ƒå°†å‘å…¶æ·»åŠ æ ·å¼å±æ€§ã€‚

```jsx
<NavLink
  to='/'
  style={({ isActive }) => (isActive ? activeStyle : undefined)}
>
  Home
</NavLink>
```

## 5. < Navigate>

[< Navigate >](https://reactrouter.com/en/main/components/navigate) ç¼–ç¨‹å¼è·¯ç”±è·³è½¬çš„å£°æ˜å¼ç‰ˆæœ¬ï¼ŒAPIä¸€è‡´ï¼Œé€šè¿‡å®ƒå¯ä»¥è®©æˆ‘ä»¬ä»¥æ ‡ç­¾çš„å½¢å¼å®ç°è·¯ç”±çš„æ“ä½œï¼Œæ¯”å¦‚è·³è½¬ã€é‡å®šå‘ç­‰ã€‚

```react
isLogin ? (<Home />) : (<Navigate to="/login" />)
```

> **Tipsï¼š** ç±»ä¼¼äº v6 ç‰ˆæœ¬ä½ ä¹‹å‰çš„ [< Redirect >](https://reacttraining.com/react-router/web/api/Redirect) ï¼Œä½†æ¯”å…¶æ›´å¼ºå¤§ã€‚

é’©å­å‡½æ•°ï¼š[useNavigate >>](https://reactrouter.com/en/main/hooks/use-navigate)

## 6. < Outlet >

[< Outlet >](https://reactrouter.com/en/main/components/outlet) åº”è¯¥åœ¨çˆ¶è·¯ç”±å…ƒç´ ä¸­ä½¿ç”¨æ¥æ¸²æŸ“å­è·¯ç”±å…ƒç´ ã€‚ è¿™å…è®¸åœ¨æ¸²æŸ“å­è·¯ç”±æ—¶æ˜¾ç¤ºåµŒå¥—UIã€‚ å¦‚æœçˆ¶è·¯ç”±å®Œå…¨åŒ¹é…ï¼Œå®ƒä¼šæ¸²æŸ“ä¸€ä¸ªå­ç´¢å¼•è·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•è·¯ç”±åˆ™ä»€ä¹ˆéƒ½ä¸æ¸²æŸ“ã€‚

å¦‚æœä½ ç†Ÿæ‚‰ Vueï¼Œå¯ä»¥å°†å…¶ç†è§£ä¸º Vue ä¸­çš„ `< router-view />`

# ä¸‰ã€æ•™ç¨‹

## å‡†å¤‡

```shell
$ pnpm create vite react-router-examples --template react-ts
$ cd react-router && pnpm install
$ pnpm add react-router-dom
```

## åˆ›å»ºæ ¹è·¯ç”±è§†å›¾

é¦–å…ˆæˆ‘ä»¬ä¸ºè¿™ä¸ªåº”ç”¨ç¨‹åºæ·»åŠ å…¨å±€å¸ƒå±€

ğŸ‘‰ **`src/layouts/index.css`** 

```css
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  list-style: none;
}
.layouts header {
  height: 100px;
  line-height: 100px;
  text-align: center;
  border-bottom: 1px solid #eee;
}

.layouts main {
  height: calc(100vh - 100px);
  display: flex;
}
.layouts aside {
  width: 200px;
  height: 100%;
  background-color: #f8f8f8;
  padding: 16px;
  line-height: 30px;
}
.layouts .contents {
  height: 100%;
  flex: 1;
  padding: 16px;
  overflow-y: scroll;
}

.layouts a {
  display: block;
  text-decoration: none;
  padding: 0 8px;
  border-radius: 6px;
  color: #444444;
  margin-bottom: 10px;
}
.layouts .active {
  background: hsl(224, 98%, 58%);
  color: white;
}
```

ğŸ‘‰ **`src/layouts/index.tsx`**

```tsx
import React from 'react';
import './index.css';

const Layouts: React.FC = () => {
  return (
    <div className='layouts'>
      <header>
        <h2>React-Router learnings</h2>
      </header>
      <main>
        <aside></aside>
        <div className='contents'></div>
      </main>
    </div>
  );
};

export default Layouts;
```

## ä½¿ç”¨è·¯ç”±

ğŸ‘‰ **`src/router/index.tsx`**

```tsx
import { createBrowserRouter, RouteObject } from 'react-router-dom';

// -- previous imports
import Layouts from 'src/layouts';

// -- create routes
const routes: Array<RouteObject> = [
  { path: '/', element: <Layouts /> },
];
// -- create routers
const router = createBrowserRouter(routes, {
  basename: '',
});

export default router; 
```

> æç¤ºï¼šåç»­è·¯ç”±å¯¹è±¡ç»Ÿä¸€åœ¨è¯¥æ–‡ä»¶ä¸­ç®¡ç†ã€‚

ğŸ‘‰ **`src/index.tsx`**

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import router from './router';
// +++++++++++++
import { RouterProvider } from 'react-router-dom';
// +++++++++++++

import './index.css';

const root = ReactDOM.createRoot(
  document.getElementById('root') as HTMLElement
);

root.render(
  <React.StrictMode>
    {/* +++++++++++++ */}
    <RouterProvider router={router} />
    {/* +++++++++++++ */}
  </React.StrictMode>
);
```

## å¤„ç†å¼‚å¸¸ï¼ˆ404ï¼‰

å½“ç¨‹åºæŠ›å‡ºå¼‚å¸¸æ—¶ï¼ˆ404/æ•°æ®åŠ è½½å¼‚å¸¸ç­‰ç­‰ï¼‰ï¼Œè·¯ç”±ä¼šæ•è·é”™è¯¯å¹¶å‘ˆç°ä¸€ä¸ªé»˜è®¤çš„é”™è¯¯é¡µé¢ï¼Œä½ å¯ä»¥å°è¯•åœ¨æµè§ˆå™¨åœ°å€æ éšæ„è¾“å…¥ä¸€ä¸ªè·³è½¬è·¯å¾„è®¿é—®æŸ¥çœ‹ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªé¡µé¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

ğŸ‘‰ **`src/views/ErrorPage/index.tsx`**

```tsx
import { useRouteError } from 'react-router-dom';

export default function ErrorPage() {
  const error = useRouteError();
  console.log(error);
  return (
    <div id='error-page' style={{ textAlign: 'center', paddingTop: 100 }}>
      <h1>Oops!</h1>
      <p>Sorry, an unexpected error has occurred.</p>
      <p>
        <i>{(error as any).statusText || (error as any).message}</i>
      </p>
    </div>
  );
}
```

ğŸ‘‰ **`src/router/index.tsx`**

```tsx
import { createBrowserRouter, RouteObject } from 'react-router-dom';

// -- previous imports
import Layouts from 'src/layouts';

// +++++++++++++
import ErrorPage from 'src/views/ErrorPage';
// +++++++++++++

// -- create routes
const routes: Array<RouteObject> = [
  {
    path: '/',
    element: <Layouts />,
    // +++++++++++++
    errorElement: <ErrorPage />,
    // +++++++++++++
  }
];

// -- create routers
const router = createBrowserRouter(routes, {
  basename: '',
});

export default router;
```

## åˆ›å»ºé¡µé¢çº§è·¯ç”±

> æç¤ºï¼šéšä¾¿åˆ›å»ºå‡ ä¸ªé¡µé¢è§†å›¾ç»„ä»¶ç”¨äºæµ‹è¯•å³å¯ã€‚

ğŸ‘‰ **`src/view/IndexPage/index.tsx`**

```tsx
import React from 'react';
const IndexPage: React.FC = () => {
  return (
    <div className='page'>
      <b style={{ letterSpacing: 1, color: 'green' }}>This is ã€ŒIndexã€ page.</b>
    </div>
  );
};
export default IndexPage;
```

ğŸ‘‰ **`src/view/About/index.tsx`**

```tsx
import React from 'react';
const About: React.FC = () => {
  return (
    <div className='page'>
      <b style={{ letterSpacing: 1, color: 'orange' }}>This is ã€ŒAboutã€ page.</b>
    </div>
  );
};
export default About;
```

ğŸ‘‰ **`src/view/Mine/index.tsx`**

```tsx
import React from 'react';
const Mine: React.FC = () => {
  return (
    <div className='page'>
      <b style={{ letterSpacing: 1, color: 'blue' }}>This is ã€ŒMineã€ page.</b>
    </div>
  );
};
export default Mine;
```

ğŸ‘‰ **`src/view/Login/index.tsx`**

```tsx
import React from 'react';
const Login: React.FC = () => {
  return (
    <div className='page' style={{ textAlign: 'center', paddingTop: 100 }}>
      <b style={{ letterSpacing: 1, color: 'red' }}>This is ã€ŒLoginã€ page.</b>
      <p><button>ç™»å½•</button> </p>
    </div>
  );
};
export default Login;
```

ğŸ‘‰ **`src/router/index.tsx`**

```tsx
import { createBrowserRouter, RouteObject } from 'react-router-dom';

// -- previous imports
import Layouts from 'src/layouts';
import ErrorPage from 'src/views/ErrorPage';

// +++++++++++++
import IndexPage from 'src/views/IndexPage';
import About from 'src/views/About';
import Mine from 'src/views/Mine';
import Login from 'src/views/Login';
// +++++++++++++

// -- create routes
const routes: Array<RouteObject> = [
  {
    path: '/',
    element: <Layouts />,
    errorElement: <ErrorPage />,
  },
  // +++++++++++++
  { path: '/index-page', element: <IndexPage /> },
  { path: '/about', element: <About /> },
  { path: '/mine', element: <Mine /> },
  { path: '/login', element: <Login /> },
  // +++++++++++++
];
// -- create routers
const router = createBrowserRouter(routes, {
  basename: '',
});

export default router;

```

## åµŒå¥—è·¯ç”±

è¿™é‡Œæˆ‘ä»¬å°†åˆšåˆšæ–°å»ºçš„ä¸¤ä¸ªè·¯ç”±åµŒå¥—åœ¨æ ¹è·¯ç”±ä¸­ï¼Œé€šè¿‡ `children` å­—æ®µæŒ‡å®šï¼š

```tsx
// -- create routes
const routes: Array<RouteObject> = [
  {
    path: '/',
    element: <Layouts />,
    errorElement: <ErrorPage />,
    children: [
      { path: '/index-page', element: <IndexPage />, loader: rootLoader },
      { path: '/about', element: <About />, loader: rootLoader },
      { path: '/mine', element: <Mine />, loader: rootLoader },
    ],
  },
  { path: '/login', element: <Login /> },
];
```

> **æç¤ºï¼š**ä¸€èˆ¬æ¥è®²ï¼Œç™»å½•ç•Œé¢æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡µé¢ï¼Œæ— éœ€ä½¿ç”¨é€šç”¨å¸ƒå±€ï¼Œå› æ­¤è¿™é‡Œå¹¶æ²¡æœ‰å°†ç™»å½•è·¯ç”±æ”¾åœ¨æ ¹è·¯ç”±ä¸­ã€‚

å½“æˆ‘ä»¬è§†å›¾è®¿é—® `/about` è·¯ç”±ï¼Œé¡µé¢å¹¶ä¸ä¼šå‘ˆç°è§†å›¾ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦åœ¨æŒ‡å®šä½ç½®é€šè¿‡ `<Outlet />` æ¸²æŸ“è·¯ç”±è§†å›¾ã€‚

```tsx
import React from 'react';
// +++++++++++++
import { Outlet } from 'react-router-dom';
// +++++++++++++
import './index.css';

const Layouts: React.FC = () => {
  return (
    <div className='layouts'>
      <header>
        <h2>React-Router learnings</h2>
      </header>
      <main>
        <aside></aside>
        <div className='contents'>
          {/* +++++++++++++ */}
          <Outlet />
          {/* +++++++++++++ */}
        </div>
      </main>
    </div>
  );
};
export default Layouts;
```

> **æç¤ºï¼š** å¦‚æœç†Ÿæ‚‰Vueè·¯ç”±ä¸­çš„ `<router-view>`ï¼Œé‚£ä¹ˆä½ å°±èƒ½ç†è§£è¿™é‡Œçš„ `<Outlet />` äº†ï¼Œå½“ä½ éœ€è¦åœ¨å“ªé‡Œæ¸²æŸ“å­è·¯ç”±ï¼Œå°±åœ¨å“ªé‡Œæ·»åŠ  `<Outlet />` æ ‡ç­¾å³å¯ã€‚

## å®¢æˆ·ç«¯è·¯ç”± \<Link>

ğŸ‘‰ **`src/layouts/index.tsx`**

```tsx
import React from 'react';
import { Outlet, Link } from 'react-router-dom';
import './index.css';

const Layouts: React.FC = () => {
  return (
    <div className='layouts'>
      <header>
        <h2>React-Router learnings</h2>
      </header>
      <main>
        <aside>
          <ul>
            {/* è·³è½¬é“¾æ¥ */}
            {/* +++++++++++++ */}
            <NavLink to={'/index-page'}>Index Page</NavLink>
          	<NavLink to={'/about'}>About</NavLink>
         	  <NavLink to={'/mine'}>Mine</NavLink>
            {/* +++++++++++++ */}
          </ul>
        </aside>
        <div className='contents'>
          {/* æ¸²æŸ“å­è·¯ç”± */}
          <Outlet />
        </div>
      </main>
    </div>
  );
};

export default Layouts;
```

## è·¯ç”±åŠ è½½å™¨å‡½æ•° *

æ¯ä¸ªè·¯ç”±éƒ½å¯ä»¥å®šä¹‰ä¸€ä¸ª **åŠ è½½å™¨** å‡½æ•°ï¼Œä»¥ä¾¿åœ¨æ¸²æŸ“ä¹‹å‰å‘è·¯ç”±å…ƒç´ æä¾›æ•°æ®ã€‚è¿™ä¸ªå‡½æ•°ç‰¹åˆ«ç‰›Xï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œå®ç°æƒé™æ ¡éªŒã€ç™»å½•è¿‡æœŸåˆ¤æ–­ã€é‡å®šå‘ç­‰ç­‰æ“ä½œã€‚ä¸»è¦é€šè¿‡ [loader](https://reactrouter.com/en/main/route/loader) å’Œ [useLoaderData](https://reactrouter.com/en/main/hooks/use-loader-data) ä¸¤ä¸ª API å®ç°ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•åœ¨è·³è½¬è‡³ `Mine` é¡µé¢ä¹‹å‰ï¼Œå…ˆè·å–ç”¨æˆ·æ•°æ®ï¼Œç„¶ååœ¨è·³è½¬ï¼Œå½“ç”¨æˆ·æœªç™»å½•æ—¶ï¼Œè·³è½¬è‡³ç™»å½•é¡µã€‚

ğŸ‘‰ **`src/views/Mine/index.tsx`**

```tsx
import React from 'react';
import { redirect, useLoaderData } from 'react-router-dom';

// +++++++++++++
interface InfosType {
  name: string;
  job: string;
}
interface ResponseType {
  code: number;
  data: InfosType;
}
const getInfos = () =>
  new Promise<ResponseType>((resolve) => {
    setTimeout(() => {
      resolve({
        code: 200,
        data: { name: 'å¼ ä¸‰', job: 'ç¨‹åºçŒ¿' },
      });
    }, 2000);
  });
export const loader = async () => {
  console.log('é¡µé¢åŠ è½½å‰è¯·æ±‚ç”¨æˆ·ä¿¡æ¯...');
  const { code, data } = await getInfos();
  if (code === 401) {
    return redirect('/login');
  }
  return data;
};
// +++++++++++++

const Mine: React.FC = () => {
  // +++++++++++++
  // -- è®¿é—® loader ä¼ é€’çš„æ•°æ®
  const infos = useLoaderData() as InfosType;
  // +++++++++++++
  return (
    <div className='page'>
      <b style={{ letterSpacing: 1, color: 'blue' }}>This is ã€ŒMineã€ page.</b>
      {/* +++++++++++++ */}
      <p>{infos.name} - {infos.job}</p>
      {/* +++++++++++++ */}
    </div>
  );
};
export default Mine;
```

ğŸ‘‰ **`src/router/index.tsx`**

```tsx
import { createBrowserRouter, RouteObject } from 'react-router-dom';

// -- previous imports
import Layouts from 'src/layouts';
import ErrorPage from 'src/views/ErrorPage';
import IndexPage from 'src/views/IndexPage';
import About from 'src/views/About';
import Mine, { loader as mineLoader } /** æ–°å¢ */ from 'src/views/Mine';
import Login from 'src/views/Login';
import Details from 'src/views/Details';

// -- create routes
const routes: Array<RouteObject> = [
  {
    path: '/',
    element: <Layouts />,
    errorElement: <ErrorPage />,
    children: [
      { path: '/index-page', element: <IndexPage /> },
      { path: '/about', element: <About />},
      { path: '/mine', element: <Mine />, loader: mineLoader /** æ–°å¢ */ },
      { path: '/details/:id?', element: <Details /> },
    ],
  },
  { path: '/login', element: <Login /> },
];
// -- create routers
const router = createBrowserRouter(routes, {
  basename: '',
});

export default router;

```

## å…¨å±€æŒ‚è½½UI

å½“ä½ é€šè¿‡ `loader` åœ¨ç•Œé¢è·³è½¬ä¹‹å‰è¯·æ±‚æ•°æ®æ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­åº”ç”¨ç¨‹åºä¼šæœ‰æ˜æ˜¾çš„è¿Ÿé’æ„Ÿï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºç”¨æˆ·æä¾›ä¸€äº›åé¦ˆï¼Œä»è€Œæå‡ç”¨æˆ·ä½“éªŒã€‚è¿™é‡Œ ä½¿ç”¨ [useNavigation](https://reactrouter.com/en/main/hooks/use-navigation) API.

ğŸ‘‰ **`src/layouts/index.tsx`**

```tsx
import React from 'react';
import { Outlet, NavLink, useNavigation /** æ–°å¢ */ } from 'react-router-dom';
import './index.css';

const Layouts: React.FC = () => {
  const navigation = useNavigation();
  return (
    <div className='layouts'>
      <header>
        <h2>React-Router learnings</h2>
      </header>
      <main>
        <aside>
          <NavLink to={'/index-page'}>Index Page</NavLink>
          <NavLink to={'/about'}>About</NavLink>
          <NavLink to={'/mine'}>Mine</NavLink>
        </aside>
        <div className={`contents ${navigation.state === 'loading' ? 'loading' : ''/** æ–°å¢ */}`}>
          {/* æ¸²æŸ“å­è·¯ç”± */}
          <Outlet />
        </div>
      </main>
    </div>
  );
};

export default Layouts;
```

> **æç¤ºï¼š**ä½ å¯ä»¥è®¾ç½® `div.contents.loading` çš„æ ·å¼æ¥æå‡ç”¨æˆ·ä½“éªŒï¼Œæ¯”å¦‚ï¼šæ¨¡ç³Šã€æ¸å˜ã€è½¬åœˆæˆ–è€…é®ç½©éƒ½å¯ä»¥ã€‚

## è·¯ç”±è·³è½¬

è·¯ç”±è·³è½¬ä¸»è¦æœ‰ä¸¤ç§å½¢å¼ï¼šå£°æ˜å¼ [\<Link>](https://reactrouter.com/en/main/components/link) / ç¼–ç¨‹å¼ [useNavigate](https://reactrouter.com/en/main/hooks/use-navigate)

ğŸ‘‰ **å£°æ˜å¼**

```tsx
<Link to={'/details'}>Jump To Details</Link>
```

ğŸ‘‰ **ç¼–ç¨‹å¼**

```tsx
import { useNavigate } from 'react-router-dom';
const navigate = useNavigate();
navigate('/details');
```

> **æç¤ºï¼š** å¦‚æœä½ æƒ³è¦è¿”å›ä¸Šä¸€é¡µï¼Œç›´æ¥ä½¿ç”¨ `navigate(-1)` å³å¯ï¼Œå®˜æ–¹æ²¡æœ‰æä¾›ç±»ä¼¼äº `go` æˆ–è€… `back` çš„æ–¹æ³•ã€‚

## è·¯ç”±å‚æ•°

### [useParams](https://reactrouter.com/en/main/hooks/use-params)

1ï¼‰è®¾ç½®å‚æ•°

```tsx
// -- å£°æ˜å¼
<Route path={"/details/:id"} element={<Details />}/>

// -- ç¼–ç¨‹å¼
{ path: '/details/:id', element: <Details /> }
```

> **Tipsï¼š**åœ¨å‚æ•°åé¢åŠ ä¸Š `?` è¡¨ç¤ºå¯é€‰å‚æ•°ã€‚å¦‚ï¼š*`/details/:id/:type?`* å…¶ä¸­ `type` ä¸ºå¯é€‰å‚æ•°

2ï¼‰ä¼ é€’å‚æ•°

```tsx
// -- å£°æ˜å¼
<Link to='/details/123'>Details</Link>

// -- ç¼–ç¨‹å¼
navigate('/details/123');
```

3ï¼‰è¯»å–å‚æ•°

```jsx
const { id } = useParams();
```

### [useSearchParams](https://reactrouter.com/en/main/hooks/use-search-params)

1ï¼‰ä¼ é€’å‚æ•°

```jsx
// -- å£°æ˜å¼
<Link to='/details?id=123'>Details</Link>

// -- ç¼–ç¨‹å¼
navigate('/details?id=123');
```

2ï¼‰è¯»å–å‚æ•°

```react
import { useSearchParams } from 'react-router-dom';
const [searchParams] = useSearchParams();
const id = searchParams.get('id');
```

### State

 åŒqueryå·®ä¸å¤šï¼Œåªæ˜¯å±æ€§ä¸ä¸€æ ·ï¼Œè€Œä¸”stateä¼ çš„å‚æ•°æ˜¯åŠ å¯†çš„ï¼Œqueryä¼ çš„å‚æ•°æ˜¯å…¬å¼€çš„ã€‚

1ï¼‰ä¼ é€’å‚æ•°

```jsx
// -- å£°æ˜å¼
<Link to={'/details'} state={{ name: 'å¼ ä¸‰', job: 'å‰ç«¯å·¥ç¨‹å¸ˆ' }}>Jump To Details</Link>

// -- ç¼–ç¨‹å¼
navigate('/details', {
  state: { name: 'å¼ ä¸‰', job: 'å‰ç«¯å·¥ç¨‹å¸ˆ' },
});
```

2ï¼‰è¯»å–å‚æ•°

```jsx
import { useLocation } from 'react-router-dom';
const { state } = useLocation();
state.name
state.job
```

## å¯¼èˆªé“¾æ¥æ¿€æ´»æ ·å¼

ä½¿ç”¨ï¼š[\<NavLink />](https://reactrouter.com/en/main/components/nav-link)

```tsx
<NavLink to={'/index-page'} className={({ isActive }) => (isActive ? 'active' : '')} >
  Index Page
</NavLink>
```

> **æç¤ºï¼š**å½“é¡µé¢ä¸­å­˜åœ¨å¤šä¸ª `<NavLink>` æ ‡ç­¾æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸ºæ¯ä¸ªæ ‡ç­¾éƒ½é‡å¤åŠ¨æ€è®¾ç½® `className` å±æ€§ï¼Œåªéœ€è¦ä¸ºç¬¬ä¸€ä¸ªæ ‡ç­¾è®¾ç½®å³å¯ï¼Œè·¯ç”±ä¼šå»è‡ªåŠ¨å¤„ç†ã€‚

## è·¯ç”±æ‡’åŠ è½½

```tsx
const Details = React.lazy(() => import('@/pages/Details'));
```

å¦‚æœä½ ä½¿ç”¨äº†è·¯ç”±æ‡’åŠ è½½ï¼Œé‚£ä½ å¿…é¡»é…å¥—ä½¿ç”¨ *React.Suspense*ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼š

*A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition*

é‚£åœ¨å“ªé‡Œæ·»åŠ å‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œå¦‚æœå…¨å±€éƒ½æ˜¯æ‡’åŠ è½½è·¯ç”±ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨å…¥å£æ–‡ä»¶æ·»åŠ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```tsx
root.render(
  <React.StrictMode>
    <React.Suspense fallback={<div>Loading...</div>}>
      <RouterProvider router={router} />
    </React.Suspense>
  </React.StrictMode>
);
```

å¦‚æœåªæ˜¯å­è·¯ç”±éœ€è¦æ‡’åŠ è½½ï¼ˆ*é€šå¸¸æˆ‘ä»¬å»ºè®®è¿™ä¹ˆåš*ï¼‰ï¼Œä½ åªéœ€è¦å°†å…¶åµŒå¥—åœ¨ `<Outlet />` æ ‡ç­¾ä¸Šå³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```tsx
<React.Suspense fallback={<div>Loading...</div>}>
  <Outlet />
</React.Suspense>
```

> **æç¤ºï¼š**`fallback` ä¼ é€’çš„è‡ªå®šä¹‰åŠ è½½è§†å›¾ä½ å¯ä»¥è‡ªè¡Œå®šä¹‰ã€‚

## ç´¢å¼•è·¯ç”±

å½“ä¸€ä¸ªè·¯ç”±æœ‰å­è·¯ç”±æ—¶ï¼Œä½ åœ¨çˆ¶è·¯ç”±çš„è·¯å¾„ä¸Šï¼Œè¾“å‡º `<Outlet>` æ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥æ¸²æŸ“ï¼Œå› ä¸ºæ²¡æœ‰åŒ¹é…çš„å­å…ƒç´ ã€‚æ‚¨å¯ä»¥å°†ç´¢å¼•è·¯ç”±ï¼ˆIndexRoutesï¼‰è§†ä¸ºå¡«å……è¯¥ç©ºé—´çš„é»˜è®¤å­è·¯ç”±ã€‚

```tsx
{ index: true, element: <IndexPage /> },
```

> **æç¤ºï¼š**`index` å’Œ `path` å±æ€§æ˜¯äº’æ–¥çš„ï¼ŒäºŒé€‰ä¸€ã€‚

## JSXè·¯ç”±é…ç½®

```tsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import {
  Link,
  Outlet,
  Route,
  RouterProvider,
  createBrowserRouter,
  createRoutesFromElements,
} from 'react-router-dom';

const root = ReactDOM.createRoot(
  document.getElementById('root') as HTMLElement
);

const Layouts = () => (
  <div className='layouts'>
    <ul>
      <li><Link to={'/'}>Index</Link></li>
      <li><Link to={'/about'}>About</Link></li>
      <li><Link to={'/infos/123'}>Infos</Link></li>
      <li><Link to={'/error'}>Error</Link></li>
    </ul>
    <Outlet />
  </div>
);
const ErrorPage = () => (
  <div id='error-page' style={{ textAlign: 'center', paddingTop: 100 }}>
    <h1>Oops!</h1>
    <p>Sorry, an unexpected error has occurred.</p>
  </div>
);
const Index = () => <div>This is ã€ŒIndexã€ Page.</div>;
const About = () => <div>This is ã€ŒAboutã€ Page.</div>;
const Infos = () => <div>This is ã€ŒInfosã€ Page.</div>;

const router = createBrowserRouter(
  createRoutesFromElements(
    <Route path='/' element={<Layouts />} errorElement={<ErrorPage />}>
      <Route index element={<Index />} />
      <Route path='/about' element={<About />} />
      <Route path='/infos/:id' element={<Infos />} />
    </Route>
  )
);

root.render(
  <React.StrictMode>
    <React.Suspense fallback={<div>Loading...</div>}>
      <RouterProvider router={router} />
    </React.Suspense>
  </React.StrictMode>
);
```

# å››ã€æ‹“å±•

## ç²¾å‡†å¤„ç†å¼‚å¸¸

å½“æˆ‘ä»¬çš„å¸ƒå±€æ˜¯å·¦ä¾§èœå•å³ä¾§å†…å®¹å¸ƒå±€æ—¶ï¼Œç‚¹å‡»èœå•æŠ›å‡ºå¼‚å¸¸ï¼Œç›®å‰æˆ‘ä»¬æ‰€äº†è§£çš„å¼‚å¸¸å¤„ç†å‘ˆç°æ˜¯ç›´æ¥åœ¨æ•´ä¸ªå±å¹•ä¸Šå±•ç¤ºï¼Œè¿™éå¸¸ä¸å‹å¥½ï¼Œé‚£å¦‚æœæˆ‘åªæƒ³åœ¨å‘ˆç°å†…å®¹è·¯ç”±è§†å›¾çš„åœ°æ–¹å‘ˆç°é”™è¯¯ç•Œé¢åˆæ”¹å¦‚ä½•æ“ä½œå‘¢ï¼Ÿä½ å¯ä»¥ä¸ºæ¯ä¸€ä¸ªè·¯ç”±éƒ½å•ç‹¬è®¾ç½® `errorElement`ï¼Œä½†è¿™ç»å¯¹ä¸æ˜¯æˆ‘ä»¬æ‰€æ¨èçš„æ–¹å¼ï¼Œæ›´ä¼˜çš„å¤„ç†æ–¹å¼å¦‚ä¸‹ï¼š

```tsx
// -- create routes
const routes: Array<RouteObject> = [
  {
    path: '/',
    element: <Layouts />,
    errorElement: <ErrorPage />,
    children: [
      {
        errorElement: <ErrorPage />,
        children: [
          { index: true, element: <App /> },
          { path: '/index-page', element: <IndexPage /> },
          { path: '/about', element: <About /> },
          { path: '/mine', element: <Mine />, loader: mineLoader },
          { path: '/details/:id?', element: <Details /> },
        ],
      },
    ],
  },
  { path: '/login', element: <Login /> },
];
```

è¿™æ ·å®šä¹‰ï¼Œå³ä¿ç•™äº†å…¨å±€æ—¶çš„é”™è¯¯å¼‚å¸¸æ˜¾ç¤ºï¼ŒåŒæ—¶ä¹Ÿç²¾å‡†å‘ˆç°äº†å­è·¯ç”±çš„é”™è¯¯å¼‚å¸¸æ˜¾ç¤ºã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨è¯¦æƒ…é¡µæ•…æ„æŠ›å‡ºå¼‚å¸¸æŸ¥çœ‹æ•ˆæœï¼š

```tsx
useEffect(() => {
  throw new Error('oh dang!');
}, []);
```

## FAQs

[å‚è€ƒè¿™é‡Œ >>](https://reactrouter.com/en/main/start/faq#faqs)

